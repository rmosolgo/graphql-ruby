<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL - Using Connections</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <script>
      function detectDarkTheme(toggle) {
        var prefersDarkSchemeSetting = localStorage.getItem("prefersDarkScheme")
        if (prefersDarkSchemeSetting == null) {
          prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches
        } else {
          prefersDarkScheme = prefersDarkSchemeSetting == "true"
        }

        if (toggle) {
          if (prefersDarkScheme) {
            prefersDarkScheme = false
            localStorage.setItem("prefersDarkScheme", "false")
          } else {
            prefersDarkScheme = true
            localStorage.setItem("prefersDarkScheme", "true")
          }
        }

        if (prefersDarkScheme) {
          document.body.classList.add('dark-theme');
          document.querySelectorAll(".graphql-ruby-img").forEach(function(el) {
            el.src = "/graphql-ruby-dark.png"
          })
        } else {
          document.body.classList.remove('dark-theme');
          document.querySelectorAll(".graphql-ruby-img").forEach(function(el) {
            el.src = "/graphql-ruby.png"
          })
        }
      }

      detectDarkTheme(false)
    </script>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img class="graphql-ruby-img" src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <div class="nav-links">
            <a href="/getting_started">Get Started</a>
            <a href="/guides">Guides</a>
            <a href="/api-doc/2.4.14/">API</a>
            <a href="https://buttondown.email/graphql-ruby">Newsletter</a>
            <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
            <a href="https://graphql.pro">Upgrade to Pro</a>
            <input
              class="search-input"
              onkeyup="GraphQLRubySearch.run(this)"
              type="text"
              placeholder="Search the docs..."
            />
            <a href="#" onclick="event.preventDefault(); detectDarkTheme(true)" class="dark-theme-button"></a>
          </div>
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container  fullwidth ">
      <ul class="breadcrumb">
  <li><a href="/guides">Guides</a></li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/schema/definition.html">Schema</option>
      
        <option  data-target="/queries/executing_queries.html">Queries</option>
      
        <option  data-target="/type_definitions/objects.html">Type Definitions</option>
      
        <option  data-target="/authorization/overview.html">Authorization</option>
      
        <option  data-target="/fields/introduction.html">Fields</option>
      
        <option  data-target="/mutations/mutation_root.html">Mutations</option>
      
        <option  data-target="/errors/overview.html">Errors</option>
      
        <option  selected data-target="/pagination/overview.html">Pagination</option>
      
        <option  data-target="/relay/range_add.html">Relay</option>
      
        <option  data-target="/dataloader/overview.html">Dataloader</option>
      
        <option  data-target="/subscriptions/overview.html">Subscriptions</option>
      
        <option  data-target="/pro/home.html">GraphQL Pro</option>
      
        <option  data-target="/operation_store/overview.html">GraphQL Pro - OperationStore</option>
      
        <option  data-target="/defer/overview.html">GraphQL Pro - Defer</option>
      
        <option  data-target="/limiters/overview.html">GraphQL Enterprise - Rate Limiters</option>
      
        <option  data-target="/object_cache/overview.html">GraphQL Enterprise - Object Cache</option>
      
        <option  data-target="/changesets/overview.html">GraphQL Enterprise - Changesets</option>
      
        <option  data-target="/javascript_client/overview.html">JavaScript Client</option>
      
        <option  data-target="/language_tools/visitor.html">Language Tools</option>
      
        <option  data-target="/testing/overview.html">Testing</option>
      
        <option  data-target="/development.html">Other</option>
      
    </select>
  </li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/pagination/overview.html">Overview</option>
      
        <option  data-target="/pagination/connection_concepts.html">Connection Concepts</option>
      
        <option  selected data-target="/pagination/using_connections.html">Using Connections</option>
      
        <option  data-target="/pagination/custom_connections.html">Custom Connections</option>
      
        <option  data-target="/pagination/cursors.html">Cursors</option>
      
        <option  data-target="/pagination/stable_relation_connections.html">Stable Relation Connections</option>
      
    </select>
  </li>
</ul>



<h1 class="guide-header">Using Connections</h1>
<div class="guide-table-of-contents"><div class="table-of-contents">
  <h3 class="contents-header">Contents</h3>
  <ol class='contents-list'><li class='contents-entry'><a href='#make-connection-fields'>Make Connection Fields
</a><ol class='contents-list'><li class='contents-entry'><a href='#opting-out-of-default-connection-handling'>Opting out of default connection handling
</a></li></ol></li><li class='contents-entry'><a href='#return-collections'>Return Collections
</a></li><li class='contents-entry'><a href='#make-custom-connections'>Make Custom Connections
</a></li><li class='contents-entry'><a href='#special-cases'>Special Cases
</a></li><li class='contents-entry'><a href='#max-page-size'>Max Page Size
</a></li><li class='contents-entry'><a href='#default-page-size'>Default Page Size
</a></li></ol>
</div>
</div>
<div class="guide-container">
  <p>GraphQL-Ruby ships with a few implementations of the <a href="/pagination/connection_concepts">connection pattern</a> that you can use out of the box. They support Ruby Arrays, Mongoid, Sequel, and ActiveRecord.</p>

<p>Additionally, connections allow you to limit the number of items returned with <a href="#max-page-size"><code class="language-plaintext highlighter-rouge">max_page_size</code></a> and set the default number of items returned with <a href="#default-page-size"><code class="language-plaintext highlighter-rouge">default_page_size</code></a>.</p>

<h2 id="make-connection-fields">Make Connection Fields</h2>

<p>Use <code class="language-plaintext highlighter-rouge">.connection_type</code> to generate a connection type for paginating over objects of a given type:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:items</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">ItemType</span><span class="p">.</span><span class="nf">connection_type</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
</code></pre></div></div>

<p>The generated return type will be called <code class="language-plaintext highlighter-rouge">ItemConnection</code>. Since it ends in <code class="language-plaintext highlighter-rouge">*Connection</code>, the <code class="language-plaintext highlighter-rouge">field(...)</code> will automatically be configured with <code class="language-plaintext highlighter-rouge">connection: true</code>. If the connection type’s name doesn’t end in <code class="language-plaintext highlighter-rouge">Connection</code>, you have to add that configuration yourself:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># here's a custom type whose name doesn't end in "Connection", so `connection: true` is required:</span>
<span class="n">field</span> <span class="ss">:items</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">ItemConnectionPage</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">connection: </span><span class="kp">true</span>
</code></pre></div></div>

<p>The field will be given some arguments by default: <code class="language-plaintext highlighter-rouge">first</code>, <code class="language-plaintext highlighter-rouge">last</code>, <code class="language-plaintext highlighter-rouge">after</code>, and <code class="language-plaintext highlighter-rouge">before</code>.</p>

<h3 id="opting-out-of-default-connection-handling">Opting out of default connection handling</h3>

<p>To opt out of GraphQL-Ruby’s default connection handling, add <code class="language-plaintext highlighter-rouge">connection: false</code> to the field definition:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- field :items, Types::ItemType.connection_type, null: false
</span><span class="gi">+ field :items, Types::ItemType.connection_type, null: false, connection: false
</span></code></pre></div></div>

<p>Then, add any arguments you want (<code class="language-plaintext highlighter-rouge">first</code>, <code class="language-plaintext highlighter-rouge">last</code>, <code class="language-plaintext highlighter-rouge">after</code>, <code class="language-plaintext highlighter-rouge">before</code>) and make sure that your resolver returns an object that can fulfill the fields of the configured return type.</p>

<h2 id="return-collections">Return Collections</h2>

<p>With connection fields, you can return collection objects from fields or resolvers:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">items</span>
  <span class="n">object</span><span class="p">.</span><span class="nf">items</span> <span class="c1"># =&gt; eg, returns an ActiveRecord Relation</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The collection object (Array, Mongoid relation, Sequel dataset, ActiveRecord relation) will be automatically paginated with the provided arguments. Cursors will be generated based on the offset of nodes in the collection.</p>

<h2 id="make-custom-connections">Make Custom Connections</h2>

<p>If you want to paginate something that <em>isn’t</em> supported out-of-the-box, you can implement your own pagination wrapper and hook it up to GraphQL-Ruby. Read more in <a href="/pagination/custom_connections">Custom Connections</a>.</p>

<h2 id="special-cases">Special Cases</h2>

<p>Sometimes, you have <em>one collection</em> that needs special handling, unlike other instances of its class. For cases like this, you can manually apply the connection wrapper in the resolver. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">items</span>
  <span class="c1"># Get the ActiveRecord relation to paginate</span>
  <span class="n">relation</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="nf">items</span>
  <span class="c1"># Apply a custom wrapper</span>
  <span class="no">Connections</span><span class="o">::</span><span class="no">ItemsConnection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">relation</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This way, you can handle this <em>particular</em> <code class="language-plaintext highlighter-rouge">relation</code> with custom code.</p>

<h2 id="max-page-size">Max Page Size</h2>

<p>You can apply <code class="language-plaintext highlighter-rouge">max_page_size</code> to limit the number of items returned and queried from the database, regardless of what the client requests.</p>

<ul>
  <li><strong>For the whole schema</strong>, you can add it to your schema definition:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyAppSchema</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span>
  <span class="n">default_max_page_size</span> <span class="mi">50</span>
<span class="k">end</span>
</code></pre></div></div>

<p>At runtime, that value will be applied to <em>every</em> connection, unless an override is provided as described below.</p>

<ul>
  <li><strong>For a given field</strong>, add it to the field definition with a keyword:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:items</span><span class="p">,</span> <span class="no">Item</span><span class="p">.</span><span class="nf">connection_type</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span>
  <span class="ss">max_page_size: </span><span class="mi">25</span>
</code></pre></div></div>

<ul>
  <li><strong>Dynamically</strong>, you can add <code class="language-plaintext highlighter-rouge">max_page_size:</code> when you apply custom connection wrappers:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">items</span>
  <span class="n">relation</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="nf">items</span>
  <span class="no">Connections</span><span class="o">::</span><span class="no">ItemsConnection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">relation</span><span class="p">,</span> <span class="ss">max_page_size: </span><span class="mi">10</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To <em>remove</em> a <code class="language-plaintext highlighter-rouge">max_page_size</code> setting, you can pass <code class="language-plaintext highlighter-rouge">nil</code>. That will allow unbounded collections to be returned to clients.</p>

<h2 id="default-page-size">Default Page Size</h2>

<p>You can apply <code class="language-plaintext highlighter-rouge">default_page_size</code> to limit the number of items returned and queried from the database when no <code class="language-plaintext highlighter-rouge">first</code> or <code class="language-plaintext highlighter-rouge">last</code> is provided.</p>

<ul>
  <li><strong>For the whole schema</strong>, you can add it to your schema definition:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyAppSchema</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span>
  <span class="n">default_page_size</span> <span class="mi">50</span>
<span class="k">end</span>
</code></pre></div></div>

<p>At runtime, that value will be applied to <em>every</em> connection, unless an override is provided as described below.</p>

<ul>
  <li><strong>For a given field</strong>, add it to the field definition with a keyword:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:items</span><span class="p">,</span> <span class="no">Item</span><span class="p">.</span><span class="nf">connection_type</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span>
  <span class="ss">default_page_size: </span><span class="mi">25</span>
</code></pre></div></div>

<ul>
  <li><strong>Dynamically</strong>, you can add <code class="language-plaintext highlighter-rouge">default_page_size:</code> when you apply custom connection wrappers:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">items</span>
  <span class="n">relation</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="nf">items</span>
  <span class="no">Connections</span><span class="o">::</span><span class="no">ItemsConnection</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">relation</span><span class="p">,</span> <span class="ss">default_page_size: </span><span class="mi">10</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If <code class="language-plaintext highlighter-rouge">max_page_size</code> is set and <code class="language-plaintext highlighter-rouge">default_page_size</code> is higher than it, the <code class="language-plaintext highlighter-rouge">default_page_size</code> will be clamped down to match <code class="language-plaintext highlighter-rouge">max_page_size</code>. If both <code class="language-plaintext highlighter-rouge">default_page_size</code> and <code class="language-plaintext highlighter-rouge">max_page_size</code> are set to <code class="language-plaintext highlighter-rouge">nil</code>, unbounded collections will be returned.</p>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/pagination/using_connections.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Using Connections">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
  function navigateToSelected(selectElement) {
    var nextPage = selectElement.selectedOptions[0].dataset["target"]
    document.location = nextPage
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
    <script>
      detectDarkTheme(false) // do it again to update the images
    </script>
  </body>
</html>
