# frozen_string_literal: true
require "spec_helper"

describe GraphQL::Schema::Mutation do
  after do
    Jazz::Models.reset
  end

  describe "definition" do
    let(:mutation) { Jazz::AddInstrument }
    it "passes along description" do
      assert_equal "Register a new musical instrument in the database", mutation.graphql_field.description
      assert_equal "Autogenerated return type of AddInstrument", mutation.payload_type.description
    end
  end

  describe "evaluation" do
    it "runs mutations" do
      query_str = <<-GRAPHQL
      mutation {
        addInstrument(name: "Trombone", family: BRASS) {
          instrument {
            name
            family
          }
        }
      }
      GRAPHQL

      response = Jazz::Schema.execute(query_str)
      assert_equal "Trombone", response["data"]["addInstrument"]["instrument"]["name"]
      assert_equal "BRASS", response["data"]["addInstrument"]["instrument"]["family"]
    end
  end
end
