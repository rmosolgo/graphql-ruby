<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta http-equiv="refresh" content="1;url=/api-doc/2.4.10/GraphQL/Subscriptions/ActionCableSubscriptions" />
  </head>
  <body>
    <p>Class: GraphQL::Subscriptions::ActionCableSubscriptions &lt; GraphQL::S…
A subscriptions implementation that sends data as ActionCable
broadcastings. 
Some things to keep in mind:</p>
<ul>
  <li>No queueing system; ActiveJob should be added - Take care to
reload context when re-delivering the subscription. (see
Query#subscription_update?) - Avoid the async ActionCable adapter
and use the redis or PostgreSQL adapters instead. Otherwise calling
#trigger won’t work from background jobs or the Rails console. 
Examples:
    <h1 id="adding-actioncablesubscriptions-to-your-schema">Adding ActionCableSubscriptions to your schema</h1>
    <p>class MySchema &lt; GraphQL::Schema</p>
    <h1>…</h1>
    <p>use GraphQL::Subscriptions::ActionCableSubscriptions
end</p>
    <h1 id="implementing-a-channel-for-graphql-subscriptions">Implementing a channel for GraphQL Subscriptions</h1>
    <p>class GraphqlChannel &lt; ApplicationCable::Channel
def subscribed
@subscription_ids = []
end
def execute(data)
query = data[“query”]
variables = ensure_hash(data[“variables”])
operation_name = data[“operationName”]
context = {</p>
    <h1 id="re-implement-whatever-context-methods-you-need">Re-implement whatever context methods you need</h1>
    <h1 id="in-this-channel-or-applicationcablechannel">in this channel or ApplicationCable::Channel</h1>
    <h1 id="current_user-current_user">current_user: current_user,</h1>
    <h1 id="make-sure-the-channel-is-in-the-context">Make sure the channel is in the context</h1>
    <p>channel: self,
}
result = MySchema.execute(
query,
context: context,
variables: variables,
operation_name: operation_name
)
payload = {
result: result.to_h,
more: result.subscription?,
}</p>
    <h1 id="track-the-subscription-here-so-we-can-remove-it">Track the subscription here so we can remove it</h1>
    <h1 id="on-unsubscribe">on unsubscribe.</h1>
    <p>if result.context[:subscription_id]
@subscription_ids « result.context[:subscription_id]
end
transmit(payload)
end
def unsubscribed
@subscription_ids.each { |sid|
MySchema.subscriptions.delete_subscription(sid)
}
end
private
def ensure_hash(ambiguous_param)
case ambiguous_param
when String
if ambiguous_param.present?
ensure_hash(JSON.parse(ambiguous_param))
else
{}
end
when Hash, ActionController::Parameters
ambiguous_param
when nil
{}
else
raise ArgumentError, “Unexpected parameter: #{ambiguous_param}”
end
end
end
Instance methods:
delete_subscription, deliver, execute_all, initialize,
load_action_cable_message, read_subscription, setup_stream,
stream_event_name, stream_subscription_name, write_subscription</p>
  </li>
</ul>


  </body>
</html>
