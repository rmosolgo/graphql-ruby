<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL - Development</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <script>
      function detectDarkTheme(toggle) {
        var prefersDarkSchemeSetting = localStorage.getItem("prefersDarkScheme")
        if (prefersDarkSchemeSetting == null) {
          prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches
        } else {
          prefersDarkScheme = prefersDarkSchemeSetting == "true"
        }

        if (toggle) {
          if (prefersDarkScheme) {
            prefersDarkScheme = false
            localStorage.setItem("prefersDarkScheme", "false")
          } else {
            prefersDarkScheme = true
            localStorage.setItem("prefersDarkScheme", "true")
          }
        }

        if (prefersDarkScheme) {
          document.body.classList.add('dark-theme');
          document.querySelectorAll(".graphql-ruby-img").forEach(function(el) {
            el.src = "/graphql-ruby-dark.png"
          })
        } else {
          document.body.classList.remove('dark-theme');
          document.querySelectorAll(".graphql-ruby-img").forEach(function(el) {
            el.src = "/graphql-ruby.png"
          })
        }
      }

      detectDarkTheme(false)
    </script>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img class="graphql-ruby-img" src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <div class="nav-links">
            <a href="/getting_started">Get Started</a>
            <a href="/guides">Guides</a>
            <a href="/api-doc/2.4.15/">API</a>
            <a href="https://buttondown.email/graphql-ruby">Newsletter</a>
            <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
            <a href="https://graphql.pro">Upgrade to Pro</a>
            <input
              class="search-input"
              onkeyup="GraphQLRubySearch.run(this)"
              type="text"
              placeholder="Search the docs..."
            />
            <a href="#" onclick="event.preventDefault(); detectDarkTheme(true)" class="dark-theme-button"></a>
          </div>
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container  fullwidth ">
      <ul class="breadcrumb">
  <li><a href="/guides">Guides</a></li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/schema/definition.html">Schema</option>
      
        <option  data-target="/queries/executing_queries.html">Queries</option>
      
        <option  data-target="/type_definitions/objects.html">Type Definitions</option>
      
        <option  data-target="/authorization/overview.html">Authorization</option>
      
        <option  data-target="/fields/introduction.html">Fields</option>
      
        <option  data-target="/mutations/mutation_root.html">Mutations</option>
      
        <option  data-target="/errors/overview.html">Errors</option>
      
        <option  data-target="/pagination/overview.html">Pagination</option>
      
        <option  data-target="/relay/range_add.html">Relay</option>
      
        <option  data-target="/dataloader/overview.html">Dataloader</option>
      
        <option  data-target="/subscriptions/overview.html">Subscriptions</option>
      
        <option  data-target="/pro/home.html">GraphQL Pro</option>
      
        <option  data-target="/operation_store/overview.html">GraphQL Pro - OperationStore</option>
      
        <option  data-target="/defer/overview.html">GraphQL Pro - Defer</option>
      
        <option  data-target="/limiters/overview.html">GraphQL Enterprise - Rate Limiters</option>
      
        <option  data-target="/object_cache/overview.html">GraphQL Enterprise - Object Cache</option>
      
        <option  data-target="/changesets/overview.html">GraphQL Enterprise - Changesets</option>
      
        <option  data-target="/javascript_client/overview.html">JavaScript Client</option>
      
        <option  data-target="/language_tools/visitor.html">Language Tools</option>
      
        <option  data-target="/testing/overview.html">Testing</option>
      
        <option  selected data-target="/development.html">Other</option>
      
    </select>
  </li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  selected data-target="/development.html">Development</option>
      
        <option  data-target="/getting_started.html">Getting Started</option>
      
        <option  data-target="/related_projects.html">Related Projects</option>
      
    </select>
  </li>
</ul>



<h1 class="guide-header">Development</h1>
<div class="guide-table-of-contents"><div class="table-of-contents">
  <h3 class="contents-header">Contents</h3>
  <ol class='contents-list'><li class='contents-entry'><a href='#setup'>Setup
</a></li><li class='contents-entry'><a href='#running-the-tests'>Running the Tests
</a><ol class='contents-list'><li class='contents-entry'><a href='#unit-tests'>Unit tests
</a></li><li class='contents-entry'><a href='#integration-tests'>Integration tests
</a></li><li class='contents-entry'><a href='#graphql-cparser-tests'>GraphQL-CParser tests
</a></li><li class='contents-entry'><a href='#other-tests'>Other tests
</a></li></ol></li><li class='contents-entry'><a href='#gemfiles-gemfiles-gemfiles'>Gemfiles, Gemfiles, Gemfiles
</a></li><li class='contents-entry'><a href='#debugging-with-pry'>Debugging with Pry
</a></li><li class='contents-entry'><a href='#running-the-benchmarks'>Running the Benchmarks
</a></li><li class='contents-entry'><a href='#coding-guidelines'>Coding Guidelines
</a></li><li class='contents-entry'><a href='#website'>Website
</a><ol class='contents-list'><li class='contents-entry'><a href='#search-index'>Search Index
</a></li><li class='contents-entry'><a href='#api-docs'>API Docs
</a></li></ol></li><li class='contents-entry'><a href='#versioning'>Versioning
</a></li><li class='contents-entry'><a href='#releasing'>Releasing
</a></li></ol>
</div>
</div>
<div class="guide-container">
  <p>So, you want to hack on GraphQL Ruby! Here are some tips for getting started.</p>

<ul>
  <li><a href="#setup">Setup</a> your development environment</li>
  <li><a href="#running-the-tests">Run the tests</a> to verify your setup</li>
  <li><a href="#debugging-with-pry">Debug</a> with pry</li>
  <li><a href="#running-the-benchmarks">Run the benchmarks</a> to test performance in your environment</li>
  <li><a href="#coding-guidelines">Coding guidelines</a> for working on your contribution</li>
  <li>Special tools for building the <a href="#lexer-and-parser">lexer and parser</a></li>
  <li>Building and publishing the <a href="#website">GraphQL Ruby website</a></li>
  <li><a href="#versioning">Versioning</a> describes how changes are managed and released</li>
  <li><a href="#releasing">Releasing</a> Gem versions</li>
</ul>

<h2 id="setup">Setup</h2>

<p>Get your own copy of graphql-ruby by forking <a href="https://github.com/rmosolgo/graphql-ruby"><code class="language-plaintext highlighter-rouge">rmosolgo/graphql-ruby</code> on GitHub</a> and cloning your fork.</p>

<p>Then, install the dependencies:</p>

<ul>
  <li>Install SQLite3 and MongoDB (eg, <code class="language-plaintext highlighter-rouge">brew install sqlite &amp;&amp; brew tap mongodb/brew &amp;&amp; brew install mongodb-community</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">bundle install</code></li>
  <li><code class="language-plaintext highlighter-rouge">rake compile # If you get warnings at this step, you can ignore them.</code></li>
  <li>Optional: <a href="https://www.colm.net/open-source/ragel/">Ragel</a> is required to build the lexer</li>
</ul>

<h2 id="running-the-tests">Running the Tests</h2>

<h3 id="unit-tests">Unit tests</h3>

<p>You can run the tests with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake        # tests &amp; Rubocop
bundle exec rake test   # tests only
</code></pre></div></div>

<p>You can run a <strong>specific file</strong> with <code class="language-plaintext highlighter-rouge">TEST=</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake test TEST=spec/graphql/query_spec.rb
# run tests in `query_spec.rb` only
</code></pre></div></div>

<p>You can focus on a <strong>specific example</strong> with <code class="language-plaintext highlighter-rouge">focus</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">focus</span>
<span class="n">it</span> <span class="s2">"does something cool"</span> <span class="k">do</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then, only <code class="language-plaintext highlighter-rouge">focus</code>ed tests will run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake test
# only the focused test will be run
</code></pre></div></div>

<p>(This is provided by <code class="language-plaintext highlighter-rouge">minitest-focus</code>.)</p>

<h3 id="integration-tests">Integration tests</h3>

<p>You need to pick a specific gemfile from gemfiles/ to run integration tests. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BUNDLE_GEMFILE=gemfiles/rails_6.1.gemfile bundle install
BUNDLE_GEMFILE=gemfiles/rails_6.1.gemfile bundle exec rake test TEST=spec/integration/rails/graphql/relay/array_connection_spec.rb
</code></pre></div></div>

<h3 id="graphql-cparser-tests">GraphQL-CParser tests</h3>

<p>To test the <code class="language-plaintext highlighter-rouge">graphql_cparser</code> gem, you have to build the binary first:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake build_ext
</code></pre></div></div>

<p>Then, run the test suite with <code class="language-plaintext highlighter-rouge">GRAPHQL_CPARSER=1</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GRAPHQL_CPARSER=1 bundle exec rake test
</code></pre></div></div>

<p>(Add <code class="language-plaintext highlighter-rouge">TEST=</code> to pick a certain file.)</p>

<h3 id="other-tests">Other tests</h3>

<p>There are system tests for checking ActionCable behavior, use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake test:system
</code></pre></div></div>

<p>And JavaScript tests:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake test:js
</code></pre></div></div>

<h2 id="gemfiles-gemfiles-gemfiles">Gemfiles, Gemfiles, Gemfiles</h2>

<p><code class="language-plaintext highlighter-rouge">graphql-ruby</code> has several gemfiles to ensure support for various Rails versions. You can specify a gemfile with <code class="language-plaintext highlighter-rouge">BUNDLE_GEMFILE</code>, eg:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BUNDLE_GEMFILE=gemfiles/rails_5.gemfile bundle exec rake test
</code></pre></div></div>

<h2 id="debugging-with-pry">Debugging with Pry</h2>

<p><a href="https://pryrepl.org/"><code class="language-plaintext highlighter-rouge">pry</code></a> is included with GraphQL-Ruby’s development setup to help with debugging.</p>

<p>To pause execution in Ruby code, add:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">binding</span><span class="p">.</span><span class="nf">pry</span>
</code></pre></div></div>

<p>Then, the program will pause and your terminal will become a Ruby REPL. Feel free to use <code class="language-plaintext highlighter-rouge">pry</code> in your development process!</p>

<h2 id="running-the-benchmarks">Running the Benchmarks</h2>

<p>This project includes some Rake tasks to record benchmarks:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bundle <span class="nb">exec </span>rake <span class="nt">-T</span> | <span class="nb">grep </span>bench:
rake bench:profile         <span class="c"># Generate a profile of the introspection query</span>
rake bench:query           <span class="c"># Benchmark the introspection query</span>
rake bench:validate        <span class="c"># Benchmark validation of several queries</span>
</code></pre></div></div>

<p>You can save results by sending the output into a file:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bundle <span class="nb">exec </span>rake bench:validate <span class="o">&gt;</span> before.txt
<span class="nv">$ </span><span class="nb">cat </span>before.txt
<span class="c"># ...</span>
<span class="c"># --&gt; benchmark output here</span>
</code></pre></div></div>

<p>If you want to check performance, create a baseline by running these tasks before your changes. Then, make your changes and run the tasks again and compare your results.</p>

<p>Keep these points in mind when using benchmarks:</p>

<ul>
  <li>The results are hardware-specific: computers with different hardware will have different results. So don’t compare your results to results from other computers.</li>
  <li>The results are environment-specific: CPU and memory availability are affected by other processes on your computer. So try to create similar environments for your before-and-after testing.</li>
</ul>

<h2 id="coding-guidelines">Coding Guidelines</h2>

<p>GraphQL-Ruby uses a thorough test suite to make sure things work reliably day-after-day. Please include tests that describe your changes, for example:</p>

<ul>
  <li>If you contribute a bug fix, include a test for the code that <em>was</em> broken (and is now fixed)</li>
  <li>If you contribute a feature, include tests for all intended uses of that feature</li>
  <li>If you modify existing behavior, update the tests to cover all intended behaviors for that code</li>
</ul>

<p>Don’t fret about coding style or organization.  There’s a minimal Rubocop config in <code class="language-plaintext highlighter-rouge">.rubocop.yml</code> which runs during CI. You can run it manually with <code class="language-plaintext highlighter-rouge">bundle exec rake rubocop</code>.</p>

<h2 id="website">Website</h2>

<p>To update the website, update the <code class="language-plaintext highlighter-rouge">.md</code> files in <code class="language-plaintext highlighter-rouge">guides/</code>.</p>

<p>To preview your changes, you can serve the website locally:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake site:serve
</code></pre></div></div>

<p>Then visit <code class="language-plaintext highlighter-rouge">http://localhost:4000</code>.</p>

<p>To publish the website with GitHub pages, run the Rake task:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle exec rake site:publish
</code></pre></div></div>

<h3 id="search-index">Search Index</h3>

<p>GraphQL-Ruby’s search index is powered by Algolia. To update the index, you need the API key in an environment variable:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ export ALGOLIA_API_KEY=...
</code></pre></div></div>

<p>Without this key, the search index will fall out-of-sync with the website. Contact @rmosolgo to gain access to this key.</p>

<h3 id="api-docs">API Docs</h3>

<p>The GraphQL-Ruby website has its own rendered version of the gem’s API docs. They’re pushed to GitHub pages with a special process.</p>

<p>First, generate local copies of the docs you want to publish:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bundle exec rake apidocs:gen_version[1.8.0] # for example, generate docs that you want to publish
</code></pre></div></div>

<p>Then, check them out locally:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bundle exec rake site:serve
# then visit http://localhost:4000/api-doc/1.8.0/
</code></pre></div></div>

<p>Then, publish them as part of the whole site:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bundle exec rake site:publish
</code></pre></div></div>

<p>Finally, check your work by visiting the docs on the website.</p>

<h2 id="versioning">Versioning</h2>

<p>GraphQL-Ruby does <em>not</em> attempt to deliver “semantic versioning” for the reasons described in <code class="language-plaintext highlighter-rouge">jashkenas</code>’
s post, <a href="https://gist.github.com/jashkenas/cbd2b088e20279ae2c8e">“Why Semantic Versioning Isn’t”</a>. Instead, the following scheme is used as a guideline:</p>

<ul>
  <li>Version numbers consist of three parts, <code class="language-plaintext highlighter-rouge">MAJOR.MINOR.PATCH</code></li>
  <li><strong><code class="language-plaintext highlighter-rouge">PATCH</code></strong> version indicates bug fixes or small features for specific use cases. Ideally, you can upgrade patch versions with only a quick skim of the changelog.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">MINOR</code></strong> version indicates significant additions, internal refactors, or small breaking changes. When upgrading a minor version, check the changelog for any new features or breaking changes which apply to your system. The changelog will always include an upgrade path for any breaking changes. Minor versions may also include deprecation warnings to warn about upcoming breaking changes.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">MAJOR</code></strong> version indicates significant breaking changes. Do not expect code to run without some modification, especially if the code yielded deprecation warnings.</li>
</ul>

<p>This policy is inspired by the <a href="https://www.ruby-lang.org/en/news/2013/12/21/ruby-version-policy-changes-with-2-1-0/">Ruby 2.1.0+ version policy</a>.</p>

<p>Pull requests and issues may be tagged with a <a href="https://github.com/rmosolgo/graphql-ruby/milestones">GitHub milestone</a> to denote when they’ll be released.</p>

<p>The <a href="https://github.com/rmosolgo/graphql-ruby/blob/master/CHANGELOG.md">changelog</a> should always contain accurate and thorough information so that users can upgrade. If you have trouble upgrading based on the changelog, please open an issue on GitHub.</p>

<h2 id="releasing">Releasing</h2>

<p>GraphQL-Ruby doesn’t have a strict release schedule. If you think it should, consider opening an issue to share your thoughts.</p>

<p>To cut a release:</p>

<ul>
  <li>Update <code class="language-plaintext highlighter-rouge">CHANGELOG.md</code> for the new version:
    <ul>
      <li>Add a new heading for the new version, and paste the four categories of changes into the new section</li>
      <li>Open the GitHub milestone corresponding to the new version</li>
      <li>Check each pull request and put it in the category (or categories) that it belongs in
        <ul>
          <li>If a change affects the default behavior of GraphQL-Ruby in a disruptive way, add it to <code class="language-plaintext highlighter-rouge">## Breaking Changes</code> and include migration notes if possible</li>
          <li>Include the PR number beside the change description for future reference</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Update <code class="language-plaintext highlighter-rouge">lib/graphql/version.rb</code> with the new version number</li>
  <li>Commit changes to master</li>
  <li>Push changes to GitHub: <code class="language-plaintext highlighter-rouge">git push origin master</code>. GitHub Actions will update the website.</li>
  <li>Release to RubyGems: <code class="language-plaintext highlighter-rouge">bundle exec rake release</code>. This will also push the tag to GitHub which will kick off a GitHub Actions job to update the API docs.</li>
  <li>Celebrate 🎊  !</li>
</ul>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/development.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Development">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
  function navigateToSelected(selectElement) {
    var nextPage = selectElement.selectedOptions[0].dataset["target"]
    document.location = nextPage
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
    <script>
      detectDarkTheme(false) // do it again to update the images
    </script>
  </body>
</html>
