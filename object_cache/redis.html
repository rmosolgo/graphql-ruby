<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL Enterprise - Object Cache - Redis Configuration</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <a href="/getting_started">Get Started</a>
          <a href="/guides">Guides</a>
          <a href="/api-doc/2.0.22/">API</a>
          <a href="https://tinyletter.com/graphql-ruby">Newsletter</a>
          <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
          <a href="https://graphql.pro">Upgrade to Pro</a>
          <input
            class="search-input"
            onkeyup="GraphQLRubySearch.run(this)"
            type="text"
            placeholder="Search the docs..."
          />
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container">
      <ul class="breadcrumb">
  <li><a href="/guides">Guides</a></li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/schema/definition.html">Schema</option>
      
        <option  data-target="/queries/executing_queries.html">Queries</option>
      
        <option  data-target="/type_definitions/objects.html">Type Definitions</option>
      
        <option  data-target="/authorization/overview.html">Authorization</option>
      
        <option  data-target="/fields/introduction.html">Fields</option>
      
        <option  data-target="/mutations/mutation_root.html">Mutations</option>
      
        <option  data-target="/errors/overview.html">Errors</option>
      
        <option  data-target="/pagination/overview.html">Pagination</option>
      
        <option  data-target="/relay/range_add.html">Relay</option>
      
        <option  data-target="/dataloader/overview.html">Dataloader</option>
      
        <option  data-target="/subscriptions/overview.html">Subscriptions</option>
      
        <option  data-target="/pro/home.html">GraphQL Pro</option>
      
        <option  data-target="/operation_store/overview.html">GraphQL Pro - OperationStore</option>
      
        <option  data-target="/defer/overview.html">GraphQL Pro - Defer</option>
      
        <option  data-target="/limiters/overview.html">GraphQL Enterprise - Rate Limiters</option>
      
        <option  selected data-target="/object_cache/overview.html">GraphQL Enterprise - Object Cache</option>
      
        <option  data-target="/changesets/overview.html">GraphQL Enterprise - Changesets</option>
      
        <option  data-target="/javascript_client/overview.html">JavaScript Client</option>
      
        <option  data-target="/language_tools/visitor.html">Language Tools</option>
      
        <option  data-target="/testing/overview.html">Testing</option>
      
        <option  data-target="/development.html">Other</option>
      
    </select>
  </li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/object_cache/overview.html">GraphQL ObjectCache</option>
      
        <option  data-target="/object_cache/schema_setup.html">Schema Setup</option>
      
        <option  data-target="/object_cache/caching.html">Caching Results</option>
      
        <option  selected data-target="/object_cache/redis.html">Redis Configuration</option>
      
        <option  data-target="/object_cache/runtime_considerations.html">Runtime Considerations</option>
      
    </select>
  </li>
</ul>



  <div class="enterprise-header">
    <p>
      <strong>ðŸŒŸ Enterprise Feature ðŸŒŸ</strong>
      <span style="font-style: italic;">
        This feature is bundled with <a href="https://graphql.pro/enterprise">GraphQL-Enterprise</a>.
      </span>
    </p>
  </div>

<h1 class="guide-header">Redis Configuration</h1>
<div class="guide-table-of-contents"><div class="table-of-contents">
  <h3 class="contents-header">Contents</h3>
  <ol class='contents-list'><li class='contents-entry'><a href='#data-structure'>Data Structure
</a></li><li class='contents-entry'><a href='#memory-management'>Memory Management
</a></li></ol>
</div>
</div>
<div class="guide-container">
  <p><code class="language-plaintext highlighter-rouge">GraphQL::Enterprise::ObjectCache</code> requires a Redis connection to store cached responses. Unlike <code class="language-plaintext highlighter-rouge">OperationStore</code> or rate limiters, this Redis instance should be configured to evict keys as needed.</p>

<h2 id="data-structure">Data Structure</h2>

<p>Under the hood, <code class="language-plaintext highlighter-rouge">ObjectCache</code> stores a mapping of queries and objects. Additionally, there are back-references from objects to queries that reference them. In general, like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"query1:result" =&gt; '{"data":{...}}'
"query1:objects" =&gt; ["obj1:v1", "obj2:v2"]

"query2:result" =&gt; '{"data":{...}}'
"query2:objects" =&gt; ["obj2:v2", "obj3:v1"]

"obj1:v1" =&gt; { "fingerprint" =&gt; "...", "id" =&gt; "...", "type_name" =&gt; "..." }
"obj2:v2" =&gt; { "fingerprint" =&gt; "...", "id" =&gt; "...", "type_name" =&gt; "..." }
"obj3:v1" =&gt; { "fingerprint" =&gt; "...", "id" =&gt; "...", "type_name" =&gt; "..." }

"obj1:v1:queries" =&gt; ["query1"]
"obj2:v2:queries" =&gt; ["query1", "query2"]
"obj3:v1:queries" =&gt; ["query2"]
</code></pre></div></div>

<p>These mappings enable proper clean-up when queries or objects are expired from the cache. Additionally, whenever <code class="language-plaintext highlighter-rouge">ObjectCache</code> finds incomplete data in storage (for example, a necessary key was evicted), then it invalidates the whole query and re-runs it.</p>

<h2 id="memory-management">Memory Management</h2>

<p>Memory consumption is hard to estimate since it depends on how many queries the cache receives, how many objects those queries reference, how big the response is for those queries, and how long the fingerprints are for each object and query. To manage memory, configure the Redis instance with a <code class="language-plaintext highlighter-rouge">maxmemory</code> and <code class="language-plaintext highlighter-rouge">maxmemory-policy</code> directive, for example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maxmemory 1gb
maxmemory-policy allkeys-lfu
</code></pre></div></div>

<p>Additionally, consider conditionally skipping the cache to prioritize your most critical GraphQL traffic.</p>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/object_cache/redis.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Redis Configuration">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
  function navigateToSelected(selectElement) {
    var nextPage = selectElement.selectedOptions[0].dataset["target"]
    document.location = nextPage
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
