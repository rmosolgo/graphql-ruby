<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL - Field Extensions</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <a href="/getting_started">Get Started</a>
          <a href="/guides">Guides</a>
          <a href="/api-doc/2.0.22/">API</a>
          <a href="https://tinyletter.com/graphql-ruby">Newsletter</a>
          <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
          <a href="https://graphql.pro">Upgrade to Pro</a>
          <input
            class="search-input"
            onkeyup="GraphQLRubySearch.run(this)"
            type="text"
            placeholder="Search the docs..."
          />
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container">
      <ul class="breadcrumb">
  <li><a href="/guides">Guides</a></li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/schema/definition.html">Schema</option>
      
        <option  data-target="/queries/executing_queries.html">Queries</option>
      
        <option  selected data-target="/type_definitions/objects.html">Type Definitions</option>
      
        <option  data-target="/authorization/overview.html">Authorization</option>
      
        <option  data-target="/fields/introduction.html">Fields</option>
      
        <option  data-target="/mutations/mutation_root.html">Mutations</option>
      
        <option  data-target="/errors/overview.html">Errors</option>
      
        <option  data-target="/pagination/overview.html">Pagination</option>
      
        <option  data-target="/relay/range_add.html">Relay</option>
      
        <option  data-target="/dataloader/overview.html">Dataloader</option>
      
        <option  data-target="/subscriptions/overview.html">Subscriptions</option>
      
        <option  data-target="/pro/home.html">GraphQL Pro</option>
      
        <option  data-target="/operation_store/overview.html">GraphQL Pro - OperationStore</option>
      
        <option  data-target="/defer/overview.html">GraphQL Pro - Defer</option>
      
        <option  data-target="/limiters/overview.html">GraphQL Enterprise - Rate Limiters</option>
      
        <option  data-target="/object_cache/overview.html">GraphQL Enterprise - Object Cache</option>
      
        <option  data-target="/changesets/overview.html">GraphQL Enterprise - Changesets</option>
      
        <option  data-target="/javascript_client/overview.html">JavaScript Client</option>
      
        <option  data-target="/language_tools/visitor.html">Language Tools</option>
      
        <option  data-target="/testing/overview.html">Testing</option>
      
        <option  data-target="/development.html">Other</option>
      
    </select>
  </li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/type_definitions/objects.html">Objects</option>
      
        <option  data-target="/type_definitions/scalars.html">Scalars</option>
      
        <option  data-target="/type_definitions/enums.html">Enums</option>
      
        <option  data-target="/type_definitions/input_objects.html">Input Objects</option>
      
        <option  data-target="/type_definitions/interfaces.html">Interfaces</option>
      
        <option  data-target="/type_definitions/unions.html">Unions</option>
      
        <option  data-target="/type_definitions/lists.html">Lists</option>
      
        <option  data-target="/type_definitions/non_nulls.html">Non-Null Types</option>
      
        <option  data-target="/type_definitions/extensions.html">Extending the GraphQL-Ruby Type Definition System</option>
      
        <option  data-target="/type_definitions/directives.html">Directives</option>
      
        <option  selected data-target="/type_definitions/field_extensions.html">Field Extensions</option>
      
    </select>
  </li>
</ul>



<h1 class="guide-header">Field Extensions</h1>
<div class="guide-table-of-contents"><div class="table-of-contents">
  <h3 class="contents-header">Contents</h3>
  <ol class='contents-list'><li class='contents-entry'><a href='#making-a-new-extension'>Making a new extension
</a></li><li class='contents-entry'><a href='#using-an-extension'>Using an extension
</a></li><li class='contents-entry'><a href='#modifying-field-configuration'>Modifying field configuration
</a></li><li class='contents-entry'><a href='#adding-default-argument-configurations'>Adding default argument configurations
</a></li><li class='contents-entry'><a href='#modifying-field-execution'>Modifying field execution
</a><ol class='contents-list'><li class='contents-entry'><a href='#execution-memo'>Execution “memo”
</a></li></ol></li><li class='contents-entry'><a href='#extension-options'>Extension options
</a></li><li class='contents-entry'><a href='#using-extras'>Using <code>extras</code>
</a></li><li class='contents-entry'><a href='#adding-an-extension-by-default'>Adding an extension by default
</a></li></ol>
</div>
</div>
<div class="guide-container">
  <p><a href="/api-doc/2.0.22/GraphQL/Schema/FieldExtension" target="_blank" title="API docs for GraphQL::Schema::FieldExtension"><code>GraphQL::Schema::FieldExtension</code></a> provides a way to modify user-defined fields in a programmatic way. For example, Relay connections are implemented as a field extension (<a href="/api-doc/2.0.22/GraphQL/Schema/Field/ConnectionExtension" target="_blank" title="API docs for GraphQL::Schema::Field::ConnectionExtension"><code>GraphQL::Schema::Field::ConnectionExtension</code></a>).</p>

<h2 id="making-a-new-extension">Making a new extension</h2>

<p>Field extensions are subclasses of <a href="/api-doc/2.0.22/GraphQL/Schema/FieldExtension" target="_blank" title="API docs for GraphQL::Schema::FieldExtension"><code>GraphQL::Schema::FieldExtension</code></a>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyExtension</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">FieldExtension</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="using-an-extension">Using an extension</h2>

<p>Defined extensions can be added to fields using the <code class="language-plaintext highlighter-rouge">extensions: [...]</code> option or the <code class="language-plaintext highlighter-rouge">extension(...)</code> method:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">extensions: </span><span class="p">[</span><span class="no">UpcaseExtension</span><span class="p">]</span>
<span class="c1"># or:</span>
<span class="n">field</span> <span class="ss">:description</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span> <span class="k">do</span>
  <span class="n">extension</span><span class="p">(</span><span class="no">UpcaseExtension</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>See below for how extensions may modify fields.</p>

<h2 id="modifying-field-configuration">Modifying field configuration</h2>

<p>When extensions are attached, they are initialized with a <code class="language-plaintext highlighter-rouge">field:</code> and <code class="language-plaintext highlighter-rouge">options:</code>. Then, <code class="language-plaintext highlighter-rouge">#apply</code> is called, when they may extend the field they’re attached to. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SearchableExtension</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">FieldExtension</span>
  <span class="k">def</span> <span class="nf">apply</span>
    <span class="c1"># add an argument to this field:</span>
    <span class="n">field</span><span class="p">.</span><span class="nf">argument</span><span class="p">(</span><span class="ss">:query</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">required: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">description: </span><span class="s2">"A search query"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This way, an extension can encapsulate a behavior requiring several configuration options.</p>

<h2 id="adding-default-argument-configurations">Adding default argument configurations</h2>

<p>Extensions may provide <em>default</em> argument configurations which are applied if the field doesn’t define the argument for itself. The configuration is passed to <a href="/api-doc/2.0.22/GraphQL/Schema/FieldExtension#default_argument-class_method" target="_blank" title="API docs for GraphQL::Schema::FieldExtension.default_argument"><code>Schema::FieldExtension.default_argument</code></a>. For example, to define a <code class="language-plaintext highlighter-rouge">:query</code> argument if the field doesn’t already have one:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SearchableExtension</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">FieldExtension</span>
  <span class="c1"># Any field which uses this extension and _doesn't_ define</span>
  <span class="c1"># its own `:query` argument will get an argument configured with this:</span>
  <span class="n">default_argument</span><span class="p">(</span><span class="ss">:query</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">required: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">description: </span><span class="s2">"A search query"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Additionally, extensions may implement <code class="language-plaintext highlighter-rouge">def after_define</code> which is called <em>after</em> the field’s <code class="language-plaintext highlighter-rouge">do .. . end</code> block. This is helpful when an extension should provide <em>default</em> configurations without overriding anything in the field definition. (When extensions are added by calling <code class="language-plaintext highlighter-rouge">field.extension(...)</code> on an already-defined field <code class="language-plaintext highlighter-rouge">def after_define</code> is called immediately.)</p>

<h2 id="modifying-field-execution">Modifying field execution</h2>

<p>Extensions have two hooks that wrap field resolution. Since GraphQL-Ruby supports deferred execution, these hooks <em>might not</em> be called back-to-back.</p>

<p>First, <a href="/api-doc/2.0.22/GraphQL/Schema/FieldExtension#resolve-instance_method" target="_blank" title="API docs for GraphQL::Schema::FieldExtension#resolve"><code>GraphQL::Schema::FieldExtension#resolve</code></a> is called. <code class="language-plaintext highlighter-rouge">resolve</code> should <code class="language-plaintext highlighter-rouge">yield(object, arguments)</code> to continue execution. If it doesn’t <code class="language-plaintext highlighter-rouge">yield</code>, then the underlying field won’t be called. Whatever <code class="language-plaintext highlighter-rouge">#resolve</code> returns will be used for continuing execution.</p>

<p>After resolution and <em>after</em> syncing lazy values (like <code class="language-plaintext highlighter-rouge">Promise</code>s from <code class="language-plaintext highlighter-rouge">graphql-batch</code>), <a href="/api-doc/2.0.22/GraphQL/Schema/FieldExtension#after_resolve-instance_method" target="_blank" title="API docs for GraphQL::Schema::FieldExtension#after_resolve"><code>GraphQL::Schema::FieldExtension#after_resolve</code></a> is called. Whatever that method returns will be used as the field’s return value.</p>

<p>See the linked API docs for the parameters of those methods.</p>

<h3 id="execution-memo">Execution “memo”</h3>

<p>One parameter to <code class="language-plaintext highlighter-rouge">after_resolve</code> deserves special attention: <code class="language-plaintext highlighter-rouge">memo:</code>. <code class="language-plaintext highlighter-rouge">resolve</code> <em>may</em> yield a third value. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">object</span><span class="p">:,</span> <span class="n">arguments</span><span class="p">:,</span> <span class="o">**</span><span class="n">rest</span><span class="p">)</span>
  <span class="c1"># yield the current time as `memo`</span>
  <span class="k">yield</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If a third value is yielded, it will be passed to <code class="language-plaintext highlighter-rouge">after_resolve</code> as <code class="language-plaintext highlighter-rouge">memo:</code>, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">after_resolve</span><span class="p">(</span><span class="n">value</span><span class="p">:,</span> <span class="n">memo</span><span class="p">:,</span> <span class="o">**</span><span class="n">rest</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Elapsed: </span><span class="si">#{</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span> <span class="o">-</span> <span class="n">memo</span><span class="si">}</span><span class="s2">"</span>
  <span class="c1"># Return the original value</span>
  <span class="n">value</span>
<span class="k">end</span>
</code></pre></div></div>

<p>This allows the <code class="language-plaintext highlighter-rouge">resolve</code> hook to pass data to <code class="language-plaintext highlighter-rouge">after_resolve</code>.</p>

<p>Instance variables may not be used because, in a given GraphQL query, the same field may be resolved several times concurrently, and that would result in overriding the instance variable in an unpredictable way. (In fact, extensions are frozen to prevent instance variable writes.)</p>

<h2 id="extension-options">Extension options</h2>

<p>The <code class="language-plaintext highlighter-rouge">extension(...)</code> method takes an optional second argument, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">extension</span><span class="p">(</span><span class="no">LimitExtension</span><span class="p">,</span> <span class="ss">limit: </span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></div>

<p>In this case, <code class="language-plaintext highlighter-rouge">{limit: 20}</code> will be passed as <code class="language-plaintext highlighter-rouge">options:</code> to <code class="language-plaintext highlighter-rouge">#initialize</code> and <code class="language-plaintext highlighter-rouge">options[:limit]</code> will be <code class="language-plaintext highlighter-rouge">20</code>.</p>

<p>For example, options can be used for modifying execution:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">after_resolve</span><span class="p">(</span><span class="n">value</span><span class="p">:,</span> <span class="o">**</span><span class="n">rest</span><span class="p">)</span>
  <span class="c1"># Apply the limit from the options, a readable attribute on the class</span>
  <span class="n">value</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:limit</span><span class="p">])</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If you use the <code class="language-plaintext highlighter-rouge">extensions: [...]</code> option, you can pass options using a hash:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">extensions: </span><span class="p">[</span><span class="no">LimitExtension</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">limit: </span><span class="mi">20</span> <span class="p">}]</span>
</code></pre></div></div>

<h2 id="using-extras">Using <code class="language-plaintext highlighter-rouge">extras</code></h2>

<p>Extensions can have the same <code class="language-plaintext highlighter-rouge">extras</code> as fields (see <a href="/fields/introduction#extra-field-metadata">Extra Field Metadata</a>). Add them by calling <code class="language-plaintext highlighter-rouge">extras</code> in the class definition:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyExtension</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">FieldExtension</span>
  <span class="n">extras</span> <span class="p">[</span><span class="ss">:ast_node</span><span class="p">,</span> <span class="ss">:errors</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Any configured <code class="language-plaintext highlighter-rouge">extras</code> will be present in the given <code class="language-plaintext highlighter-rouge">arguments</code>, but removed before the field is resolved. (However, <code class="language-plaintext highlighter-rouge">extras</code> from <em>any</em> extension will be present in <code class="language-plaintext highlighter-rouge">arguments</code> for <em>all</em> extensions.)</p>

<h2 id="adding-an-extension-by-default">Adding an extension by default</h2>

<p>If you want to apply an extension to <em>all</em> your fields, you can do this in your <a href="/type_definitions/extensions.html#customizing-fields">BaseField</a>’s <code class="language-plaintext highlighter-rouge">def initialize</code>, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::BaseField</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">Field</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="k">super</span>
    <span class="c1"># Add this to all fields based on this class:</span>
    <span class="n">extension</span><span class="p">(</span><span class="no">MyDefaultExtension</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can also <em>conditionally</em> apply extensions in <code class="language-plaintext highlighter-rouge">def initialize</code> by adding keywords to the method definition, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::BaseField</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">::</span><span class="no">Field</span>
  <span class="c1"># @param custom_extension [Boolean] if false, `MyCustomExtension` won't be added</span>
  <span class="c1"># @example skipping `MyCustomExtension`</span>
  <span class="c1">#   field :no_extension, String, custom_extension: false</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="ss">custom_extension: </span><span class="kp">true</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
    <span class="c1"># Don't apply this extension if the field is configured with `custom_extension: false`:</span>
    <span class="k">if</span> <span class="n">custom_extension</span>
      <span class="n">extension</span><span class="p">(</span><span class="no">MyCustomExtensions</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/type_definitions/field_extensions.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Field Extensions">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
  function navigateToSelected(selectElement) {
    var nextPage = selectElement.selectedOptions[0].dataset["target"]
    document.location = nextPage
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
