<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL - FAQ</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <script>
      function detectDarkTheme(toggle) {
        var prefersDarkSchemeSetting = localStorage.getItem("prefersDarkScheme")
        if (prefersDarkSchemeSetting == null) {
          prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches
        } else {
          prefersDarkScheme = prefersDarkSchemeSetting == "true"
        }

        if (toggle) {
          if (prefersDarkScheme) {
            prefersDarkScheme = false
            localStorage.setItem("prefersDarkScheme", "false")
          } else {
            prefersDarkScheme = true
            localStorage.setItem("prefersDarkScheme", "true")
          }
        }

        if (prefersDarkScheme) {
          document.body.classList.add('dark-theme');
          document.querySelectorAll(".graphql-ruby-img").forEach(function(el) {
            el.src = "/graphql-ruby-dark.png"
          })
        } else {
          document.body.classList.remove('dark-theme');
          document.querySelectorAll(".graphql-ruby-img").forEach(function(el) {
            el.src = "/graphql-ruby.png"
          })
        }
      }

      detectDarkTheme(false)
    </script>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img class="graphql-ruby-img" src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <div class="nav-links">
            <a href="/getting_started">Get Started</a>
            <a href="/guides">Guides</a>
            <a href="/api-doc/2.5.11/">API</a>
            <a href="https://buttondown.email/graphql-ruby">Newsletter</a>
            <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
            <a href="https://graphql.pro">Upgrade to Pro</a>
            <input
              class="search-input"
              onkeyup="GraphQLRubySearch.run(this)"
              type="text"
              placeholder="Search the docs..."
            />
            <a href="#" onclick="event.preventDefault(); detectDarkTheme(true)" class="dark-theme-button"></a>
          </div>
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container  fullwidth ">
      <ul class="breadcrumb">
  <li><a href="/guides">Guides</a></li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/schema/definition.html">Schema</option>
      
        <option  data-target="/queries/executing_queries.html">Queries</option>
      
        <option  data-target="/type_definitions/objects.html">Type Definitions</option>
      
        <option  data-target="/authorization/overview.html">Authorization</option>
      
        <option  data-target="/fields/introduction.html">Fields</option>
      
        <option  data-target="/mutations/mutation_root.html">Mutations</option>
      
        <option  data-target="/errors/overview.html">Errors</option>
      
        <option  data-target="/pagination/overview.html">Pagination</option>
      
        <option  data-target="/relay/range_add.html">Relay</option>
      
        <option  data-target="/dataloader/overview.html">Dataloader</option>
      
        <option  data-target="/subscriptions/overview.html">Subscriptions</option>
      
        <option  data-target="/pro/home.html">GraphQL Pro</option>
      
        <option  data-target="/operation_store/overview.html">GraphQL Pro - OperationStore</option>
      
        <option  data-target="/defer/overview.html">GraphQL Pro - Defer</option>
      
        <option  data-target="/limiters/overview.html">GraphQL Enterprise - Rate Limiters</option>
      
        <option  data-target="/object_cache/overview.html">GraphQL Enterprise - Object Cache</option>
      
        <option  data-target="/changesets/overview.html">GraphQL Enterprise - Changesets</option>
      
        <option  data-target="/javascript_client/overview.html">JavaScript Client</option>
      
        <option  data-target="/language_tools/visitor.html">Language Tools</option>
      
        <option  data-target="/testing/overview.html">Testing</option>
      
        <option  data-target="/development.html">Other</option>
      
    </select>
  </li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
    </select>
  </li>
</ul>



<h1 class="guide-header">FAQ</h1>
<div class="guide-table-of-contents"></div>
<div class="guide-container">
  <h1 id="returning-route-urls">Returning Route URLs</h1>
<p>With GraphQL there is less of a need to include resource URLs to other REST resources, however sometimes you want to use Rails routing to include a URL as one of your fields. A common use case would be to build HTML format URLs to render a link in your React UI. In that case you can pass the request to your context, so that the helpers are able to build full URLs based on the incoming host, port and protocol.</p>

<h2 id="example">Example</h2>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::UserType</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="kp">include</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">UrlFor</span>
  <span class="kp">include</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">url_helpers</span>
  <span class="c1"># Needed by ActionController::UrlFor to extract the host, port, protocol etc. from the current request</span>
  <span class="k">def</span> <span class="nf">request</span>
    <span class="n">context</span><span class="p">[</span><span class="ss">:request</span><span class="p">]</span>
  <span class="k">end</span>
  <span class="c1"># Needed by Rails.application.routes.url_helpers, it will then use the url_options defined by ActionController::UrlFor</span>
  <span class="k">def</span> <span class="nf">default_url_options</span>
    <span class="p">{}</span>
  <span class="k">end</span>
  
  <span class="n">field</span> <span class="ss">:profile_url</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="k">def</span> <span class="nf">profile_url</span>
    <span class="n">user_url</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># In your GraphQL controller, add the request to `context`:</span>
<span class="no">MySchema</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span>
  <span class="n">params</span><span class="p">[</span><span class="ss">:query</span><span class="p">],</span>
  <span class="ss">variables: </span><span class="n">params</span><span class="p">[</span><span class="ss">:variables</span><span class="p">],</span>
  <span class="ss">context: </span><span class="p">{</span>
    <span class="ss">request: </span><span class="n">request</span>
  <span class="p">},</span>
<span class="p">)</span>
</code></pre></div></div>

<h1 id="returning-activestorage-blob-urls">Returning ActiveStorage blob URLs</h1>
<p>If you are using ActiveStorage and need to return a URL to an attachment blob, you will find that using <code class="language-plaintext highlighter-rouge">Rails.application.routes.url_helpers.rails_blob_url</code> alone will throw an exception since Rails wonâ€™t know what host, port or protocol to use in it.
You can include <code class="language-plaintext highlighter-rouge">ActiveStorage::SetCurrent</code> in your GraphQL controller to pass on this information into your resolvers.</p>

<h1 id="example-1">Example</h1>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GraphqlController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="kp">include</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">SetCurrent</span>
  <span class="o">...</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Types::UserType</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="n">field</span> <span class="ss">:picture_url</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="k">def</span> <span class="nf">picture_url</span>
    <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">url_helpers</span><span class="p">.</span><span class="nf">rails_blob_url</span><span class="p">(</span>
      <span class="n">object</span><span class="p">.</span><span class="nf">picture</span><span class="p">,</span>
      <span class="ss">protocol: </span><span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Current</span><span class="p">.</span><span class="nf">url_options</span><span class="p">[</span><span class="ss">:protocol</span><span class="p">],</span>
      <span class="ss">host: </span><span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Current</span><span class="p">.</span><span class="nf">url_options</span><span class="p">[</span><span class="ss">:host</span><span class="p">],</span>
      <span class="ss">port: </span><span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Current</span><span class="p">.</span><span class="nf">url_options</span><span class="p">[</span><span class="ss">:port</span><span class="p">]</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/faq.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: FAQ">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
  function navigateToSelected(selectElement) {
    var nextPage = selectElement.selectedOptions[0].dataset["target"]
    document.location = nextPage
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
    <script>
      detectDarkTheme(false) // do it again to update the images
    </script>
  </body>
</html>
