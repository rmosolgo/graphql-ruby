<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>GraphQL Enterprise - Changesets - Defining Changesets</title>
    
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,700" rel="stylesheet" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" href="/graphql-ruby-icon.png">
  </head>
  <body>
    <div class="header">
      <div class="header-container">
        <div class="nav">
          <a href="/" class="img-link">
            <img src="/graphql-ruby.png" alt="GraphQL Ruby Logo" />
          </a>
          <a href="/getting_started">Get Started</a>
          <a href="/guides">Guides</a>
          <a href="/api-doc/2.0.22/">API</a>
          <a href="https://tinyletter.com/graphql-ruby">Newsletter</a>
          <a href="https://github.com/rmosolgo/graphql-ruby">Source Code</a>
          <a href="https://graphql.pro">Upgrade to Pro</a>
          <input
            class="search-input"
            onkeyup="GraphQLRubySearch.run(this)"
            type="text"
            placeholder="Search the docs..."
          />
        </div>
      </div>
      <div class="search-results-container">
        <div id="search-results">
        </div>
      </div>
    </div>
    <div class="container">
      <ul class="breadcrumb">
  <li><a href="/guides">Guides</a></li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/schema/definition.html">Schema</option>
      
        <option  data-target="/queries/executing_queries.html">Queries</option>
      
        <option  data-target="/type_definitions/objects.html">Type Definitions</option>
      
        <option  data-target="/authorization/overview.html">Authorization</option>
      
        <option  data-target="/fields/introduction.html">Fields</option>
      
        <option  data-target="/mutations/mutation_root.html">Mutations</option>
      
        <option  data-target="/errors/overview.html">Errors</option>
      
        <option  data-target="/pagination/overview.html">Pagination</option>
      
        <option  data-target="/relay/range_add.html">Relay</option>
      
        <option  data-target="/dataloader/overview.html">Dataloader</option>
      
        <option  data-target="/subscriptions/overview.html">Subscriptions</option>
      
        <option  data-target="/pro/home.html">GraphQL Pro</option>
      
        <option  data-target="/operation_store/overview.html">GraphQL Pro - OperationStore</option>
      
        <option  data-target="/defer/overview.html">GraphQL Pro - Defer</option>
      
        <option  data-target="/limiters/overview.html">GraphQL Enterprise - Rate Limiters</option>
      
        <option  data-target="/object_cache/overview.html">GraphQL Enterprise - Object Cache</option>
      
        <option  selected data-target="/changesets/overview.html">GraphQL Enterprise - Changesets</option>
      
        <option  data-target="/javascript_client/overview.html">JavaScript Client</option>
      
        <option  data-target="/language_tools/visitor.html">Language Tools</option>
      
        <option  data-target="/testing/overview.html">Testing</option>
      
        <option  data-target="/development.html">Other</option>
      
    </select>
  </li>
  <li>
    <select class="jump-to-select" onchange="navigateToSelected(this)">
      
        <option  data-target="/changesets/overview.html">API Versioning for GraphQL-Ruby</option>
      
        <option  data-target="/changesets/installation.html">Installing Changesets</option>
      
        <option  selected data-target="/changesets/definition.html">Defining Changesets</option>
      
        <option  data-target="/changesets/releases.html">Releasing Changesets</option>
      
    </select>
  </li>
</ul>



  <div class="enterprise-header">
    <p>
      <strong>ðŸŒŸ Enterprise Feature ðŸŒŸ</strong>
      <span style="font-style: italic;">
        This feature is bundled with <a href="https://graphql.pro/enterprise">GraphQL-Enterprise</a>.
      </span>
    </p>
  </div>

<h1 class="guide-header">Defining Changesets</h1>
<div class="guide-table-of-contents"><div class="table-of-contents">
  <h3 class="contents-header">Contents</h3>
  <ol class='contents-list'><li class='contents-entry'><a href='#changeset-classes'>Changeset Classes
</a></li><li class='contents-entry'><a href='#publishing-with-added_in'>Publishing with <code>added_in:</code>
</a></li><li class='contents-entry'><a href='#removing-with-removed_in'>Removing with <code>removed_in:</code>
</a></li><li class='contents-entry'><a href='#examples'>Examples
</a><ol class='contents-list'><li class='contents-entry'><a href='#fields'>Fields
</a></li><li class='contents-entry'><a href='#arguments'>Arguments
</a></li><li class='contents-entry'><a href='#enum-values'>Enum Values
</a></li><li class='contents-entry'><a href='#unions'>Unions
</a></li><li class='contents-entry'><a href='#interfaces'>Interfaces
</a></li><li class='contents-entry'><a href='#types'>Types
</a></li></ol></li><li class='contents-entry'><a href='#runtime'>Runtime
</a></li></ol>
</div>
</div>
<div class="guide-container">
  <p>After <a href="/changesets/installation">installing Changeset integrations</a> in your schema, you can create Changesets which modify parts of the schema. Changesets extend <code class="language-plaintext highlighter-rouge">GraphQL::Enterprise::Changeset</code> and include a <code class="language-plaintext highlighter-rouge">release</code> string. Once a Changeset class is defined, it can be referenced with <code class="language-plaintext highlighter-rouge">added_in: ...</code> or <code class="language-plaintext highlighter-rouge">removed_in: ...</code> configurations in the schema.</p>

<p><strong>Note:</strong> Before GraphQL-Enterprise 1.3.0, Changesets were configured with <code class="language-plaintext highlighter-rouge">modifies ...</code> blocks. These blocks are still supported and you can find the documentation for that API <a href="https://github.com/rmosolgo/graphql-ruby/blob/v2.0.22/guides/changesets/definition.md">on GitHub</a>.</p>

<h2 id="changeset-classes">Changeset Classes</h2>

<p>This Changeset will be available to any client whose <code class="language-plaintext highlighter-rouge">context[:changeset_version]</code> is on or after <code class="language-plaintext highlighter-rouge">2020-12-01</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/graphql/changesets/deprecate_recipe_flag.rb</span>
<span class="k">class</span> <span class="nc">Changesets::DeprecateRecipeTags</span> <span class="o">&lt;</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Enterprise</span><span class="o">::</span><span class="no">Changeset</span>
  <span class="n">release</span> <span class="s2">"2020-12-01"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Additionally, Changesets must be <a href="/changesets/releases">released</a> for their changes to be published.</p>

<h2 id="publishing-with-added_in">Publishing with <code class="language-plaintext highlighter-rouge">added_in:</code></h2>

<p>New things can be published in a changeset by adding <code class="language-plaintext highlighter-rouge">added_in: SomeChangeset</code> to their configuration. For example, to add a new argument to a field:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:search_recipes</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">Recipe</span><span class="p">]</span> <span class="k">do</span>
  <span class="n">argument</span> <span class="ss">:query</span><span class="p">,</span> <span class="no">String</span>
  <span class="n">argument</span> <span class="ss">:tags</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">RecipeTag</span><span class="p">],</span> <span class="ss">required: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">AddRecipeTags</span>
<span class="k">end</span>
</code></pre></div></div>

<p>You can also provide a <em>replacement</em> implementation by using <code class="language-plaintext highlighter-rouge">added_in:</code>. When a new definition has the same name as an existing definition, it implicitly replaces the previous definition in new versions of the API. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">field</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Integer</span><span class="p">,</span> <span class="s2">"A 1-5 score for this recipe"</span> <span class="c1"># This definition will be superseded by the following one</span>
<span class="n">field</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Float</span><span class="p">,</span> <span class="s2">"A 1.0-5.0 score for this recipe"</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">FloatingPointRatings</span>
</code></pre></div></div>

<p>Here, a new implementation for <code class="language-plaintext highlighter-rouge">rating</code> will be used when clients requests an API version that includes <code class="language-plaintext highlighter-rouge">Changesets::FloatingPointRatings</code>. (If the client requests a version <em>before</em> that changeset, then the preceding implementation would be used instead.)</p>

<h2 id="removing-with-removed_in">Removing with <code class="language-plaintext highlighter-rouge">removed_in:</code></h2>

<p>A <code class="language-plaintext highlighter-rouge">removed_in:</code> configuration removes something in the named changeset. For example, these enum values are replaced with more clearly-named ones:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::RecipeTag</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseEnum</span>
  <span class="c1"># These are replaced by *_HEAT below:</span>
  <span class="n">value</span> <span class="ss">:SPICY</span><span class="p">,</span> <span class="ss">removed_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">ClarifyHeatTags</span>
  <span class="n">value</span> <span class="ss">:MEDIUM</span><span class="p">,</span> <span class="ss">removed_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">ClarifyHeatTags</span>
  <span class="n">value</span> <span class="ss">:MILD</span><span class="p">,</span> <span class="ss">removed_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">ClarifyHeatTags</span>
  <span class="c1"># These new tags are more clear:</span>
  <span class="n">value</span> <span class="ss">:SPICY_HEAT</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">ClarifyHeatTags</span>
  <span class="n">value</span> <span class="ss">:MEDIUM_HEAT</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">ClarifyHeatTags</span>
  <span class="n">value</span> <span class="ss">:MILD_HEAT</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">ClarifyHeatTags</span>
<span class="k">end</span>
</code></pre></div></div>

<p>If something has been defined several times, a <code class="language-plaintext highlighter-rouge">removed_in:</code> configuration removes <em>all</em> definitions:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Mutations::SubmitRecipeRating</span> <span class="o">&lt;</span> <span class="no">Mutations</span><span class="o">::</span><span class="no">BaseMutation</span>
  <span class="c1"># This is replaced in future API versions by the following argument</span>
  <span class="n">argument</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Integer</span>
  <span class="c1"># This replaces the previous, but in another future version,</span>
  <span class="c1"># it is removed completely (and so is the previous one)</span>
  <span class="n">argument</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Float</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">FloatingPointRatings</span><span class="p">,</span> <span class="ss">removed_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">RemoveRatingsCompletely</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="examples">Examples</h2>

<p>See below for the different kind of modifications you can make in a changeset:</p>

<ul>
  <li><a href="#fields">Fields</a>: adding, modifying, and removing fields</li>
  <li><a href="#arguments">Arguments</a>: adding, modifying, and removing arguments</li>
  <li><a href="#enum-values">Enum values</a>: adding, modifying, and removing arguments</li>
  <li><a href="#unions">Unions</a>: adding or removing object types from a union</li>
  <li><a href="#interfaces">Interfaces</a>: adding or removing interface implementations from object types</li>
  <li><a href="#types">Types</a>: changing one type definition for another</li>
  <li><a href="#runtime">Runtime</a>: choosing a behavior at runtime based on the current request and changeset</li>
</ul>

<h3 id="fields">Fields</h3>

<p>To add or redefine a field, use <code class="language-plaintext highlighter-rouge">field(..., added_in: ...)</code>, including all configuration values for the new implementation (see <a href="/api-doc/2.0.22/GraphQL/Schema/Field#initialize-instance_method" target="_blank" title="API docs for GraphQL::Schema::Field#initialize"><code>GraphQL::Schema::Field#initialize</code></a>). The definition given here will override the previous definition (if there was one) whenever this Changeset applies.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Recipe</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="c1"># This new field is available when `context[:changeset_version]`</span>
  <span class="c1"># is on or after the release date of `AddRecipeTags`</span>
  <span class="n">field</span> <span class="ss">:tags</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">RecipeTag</span><span class="p">],</span> <span class="ss">added_in: </span><span class="no">Changeset</span><span class="o">::</span><span class="no">AddRecipeTags</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To remove a field, add a <code class="language-plaintext highlighter-rouge">removed_in: ...</code> configuration to the last definition of the field:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Recipe</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="c1"># Even after migrating to floating point values,</span>
  <span class="c1"># the "rating" feature never took off,</span>
  <span class="c1"># so we removed it entirely eventually.</span>
  <span class="n">field</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Integer</span>
  <span class="n">field</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Float</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changeset</span><span class="o">::</span><span class="no">FloatingPointRatings</span><span class="p">,</span>
    <span class="ss">removed_in: </span><span class="no">Changeset</span><span class="o">::</span><span class="no">RemoveRatings</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When a field is removed, queries that request that field will be invalid, unless the client has requested a previous API version where the field is still available.</p>

<h3 id="arguments">Arguments</h3>

<p>You can add, redefine, or remove arguments that belong to fields, input objects, or resolvers. Use <code class="language-plaintext highlighter-rouge">added_in: ...</code> to provide a new (or updated) definition for an argument, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::RecipesFilter</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseInputObject</span>
  <span class="n">argument</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Integer</span>
  <span class="c1"># This new definition is available when</span>
  <span class="c1"># the client's `context[:changeset_version]` includes `FloatingPointRatings`</span>
  <span class="n">argument</span> <span class="ss">:rating</span><span class="p">,</span> <span class="no">Float</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">FloatingPointRatings</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To remove an argument entirely, add a <code class="language-plaintext highlighter-rouge">removed_in: ...</code> configuration to the last definition. It will remove <em>all</em> implementations for that argument. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Mutations::SubmitRating</span> <span class="o">&lt;</span> <span class="no">Mutations</span><span class="o">::</span><span class="no">BaseMutation</span>
  <span class="c1"># Remove this because it's irrelevant:</span>
  <span class="n">argument</span> <span class="ss">:phone_number</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">removed_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">StopCollectingPersonalInformation</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When arguments are removed, the schema will reject any queries which use them unless the client has requested a previous API version where the argument is still allowed.</p>

<h3 id="enum-values">Enum Values</h3>

<p>With Changesets, you can add, redefine, or remove enum values. To add a new value (or provide a new implementation for a value), include <code class="language-plaintext highlighter-rouge">added_in:</code> in the <code class="language-plaintext highlighter-rouge">value(...)</code> configuration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::RecipeTag</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseEnum</span>
  <span class="c1"># This enum will accept and return `KETO` only when the client's API version</span>
  <span class="c1"># includes `AddKetoDietSupport`'s release date.</span>
  <span class="n">value</span> <span class="ss">:KETO</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">AddKetoDietSupport</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Values can be removed with <code class="language-plaintext highlighter-rouge">removed_in:</code>, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::RecipeTag</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseEnum</span>
  <span class="c1"># Old API versions will serve this value;</span>
  <span class="c1"># new versions won't accept it or return it.</span>
  <span class="n">value</span> <span class="ss">:GRAPEFRUIT_DIET</span><span class="p">,</span> <span class="ss">removed_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">RemoveLegacyDiets</span>
<span class="k">end</span>
</code></pre></div></div>

<p>When enum values are removed, they wonâ€™t be accepted as input and they wonâ€™t be allowed as return values from fields unless the client has requested a previous API version where those values are still allowed.</p>

<h3 id="unions">Unions</h3>

<p>You can add to or remove from a unionâ€™s possible types. To release a new union member, include <code class="language-plaintext highlighter-rouge">added_in:</code> in the <code class="language-plaintext highlighter-rouge">possible_types</code> configuration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Cookable</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseUnion</span>
 <span class="n">possible_types</span> <span class="no">Types</span><span class="o">::</span><span class="no">Recipe</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">Ingredient</span>
 <span class="c1"># Add this to the union when clients opt in to our new feature:</span>
 <span class="n">possible_types</span> <span class="no">Types</span><span class="o">::</span><span class="no">Cuisine</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changeset</span><span class="o">::</span><span class="no">ReleaseCuisines</span>
</code></pre></div></div>

<p>To remove a member from a union, move it to a <code class="language-plaintext highlighter-rouge">possible_types</code> call with <code class="language-plaintext highlighter-rouge">removed_in: ...</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Stop including this in the union in new API versions:</span>
<span class="n">possible_types</span> <span class="no">Types</span><span class="o">::</span><span class="no">Chef</span><span class="p">,</span> <span class="ss">removed_in: </span><span class="no">Changeset</span><span class="o">::</span><span class="no">LessChefHype</span>
</code></pre></div></div>

<p>When a possible type is removed, it will not be associated with the union type in introspection queries or schema dumps.</p>

<h3 id="interfaces">Interfaces</h3>

<p>You can add to or remove from an object typeâ€™s interface definitions. To add one or more interface implementations, use <code class="language-plaintext highlighter-rouge">implements(..., added_in:)</code>. This will add the interface and its fields to the object whenever this Changeset is active, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Recipe</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="c1"># Add this new implementation in new API versions only:</span>
  <span class="n">implements</span> <span class="no">Types</span><span class="o">::</span><span class="no">RssSubject</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">AddRssSupport</span>
<span class="k">end</span>
</code></pre></div></div>

<p>To remove one or more more interface implementations, add <code class="language-plaintext highlighter-rouge">removed_in:</code> to the <code class="language-plaintext highlighter-rouge">implements ...</code> configuration, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">implements</span> <span class="no">Types</span><span class="o">::</span><span class="no">RssSubject</span><span class="p">,</span>
    <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">AddRssSupport</span><span class="p">,</span>
    <span class="c1"># Sadly, nobody seems to want to use this,</span>
    <span class="c1"># so we removed it all:</span>
    <span class="ss">removed_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">RemoveRssSupport</span>
</code></pre></div></div>

<p>When an interface implementation is removed, then the interface will not be associated with the object in introspection queries or schema dumps. Also, any fields inherited from the interface will be hidden from clients. (If the object defines the field itself, it will still be visible.)</p>

<h3 id="types">Types</h3>

<p>Using Changesets, itâ€™s possible to define a new type using the same name as an old type. (Only one type per name is allowed for each query, but different queries can use different types for the same name.)</p>

<p>First, to define two types with the same name, make two different type definitions. One of them will have to use <code class="language-plaintext highlighter-rouge">graphql_name(...)</code> to specify the conflicting type name. For example, to migrate an enum type to an object type, define two types:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/graphql/types/legacy_recipe_flag.rb</span>

<span class="c1"># In the old version of the schema, "recipe tags" were limited to defined set of values.</span>
<span class="c1"># This enum was renamed from `Types::RecipeTag`, then `graphql_name("RecipeTag")`</span>
<span class="c1"># was added for GraphQL.</span>
<span class="k">class</span> <span class="nc">Types::LegacyRecipeTag</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseEnum</span>
  <span class="n">graphql_name</span> <span class="s2">"RecipeTag"</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/graphql/types/recipe_flag.rb</span>

<span class="c1"># But in the new schema, each tag is a full-fledged object with fields of its own</span>
<span class="k">class</span> <span class="nc">Types::RecipeTag</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="n">field</span> <span class="ss">:name</span><span class="p">,</span> <span class="no">String</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="n">field</span> <span class="ss">:is_vegetarian</span><span class="p">,</span> <span class="no">Boolean</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then, add or update fields or arguments to use the <em>new</em> type instead of the old one. For example:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  class Types::Recipe &lt; Types::BaseObject
<span class="err">
</span># Change this definition to point at the newly-renamed _legacy_ type
# (It's the same type definition, but the Ruby class has a new name)
<span class="gd">-   field :tags, [Types::RecipeTag]
</span><span class="gi">+   field :tags, [Types::LegacyRecipeTag]
</span><span class="err">
</span># And add a new field for the new type:
<span class="gi">+   field :tags, [Types::RecipeTag], added_in: Changesets::MigrateRecipeTagToObject
</span>  end
</code></pre></div></div>

<p>With that Changeset, <code class="language-plaintext highlighter-rouge">Recipe.tags</code> will return an object type instead of an enum type. Clients requesting older versions will still receive enum values from that field.</p>

<p>The resolver will probably need an update, too, for example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Recipe</span> <span class="o">&lt;</span> <span class="no">Types</span><span class="o">::</span><span class="no">BaseObject</span>
  <span class="c1"># Here's the original definition which returns enum values:</span>
  <span class="n">field</span> <span class="ss">:tags</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">LegacyRecipeTag</span><span class="p">],</span> <span class="ss">null: </span><span class="kp">false</span>
  <span class="c1"># Here's the new definition which replaces the previous one on new API versions:</span>
  <span class="n">field</span> <span class="ss">:tags</span><span class="p">,</span> <span class="p">[</span><span class="no">Types</span><span class="o">::</span><span class="no">RecipeTag</span><span class="p">],</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">added_in: </span><span class="no">Changesets</span><span class="o">::</span><span class="no">MigrateRecipeTagToObject</span>

  <span class="k">def</span> <span class="nf">flags</span>
    <span class="n">all_flag_objects</span> <span class="o">=</span> <span class="n">object</span><span class="p">.</span><span class="nf">flag_objects</span>
    <span class="k">if</span> <span class="no">Changesets</span><span class="o">::</span><span class="no">MigrateRecipeTagToObject</span><span class="p">.</span><span class="nf">active?</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="c1"># Here's the new behavior, returning full objects:</span>
      <span class="n">all_flag_objects</span>
    <span class="k">else</span>
      <span class="c1"># Convert this to enum values, for legacy behavior:</span>
      <span class="n">all_flag_objects</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="p">.</span><span class="nf">name</span><span class="p">.</span><span class="nf">upcase</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>That way, legacy clients will continue to receive enum values while new clients will receive objects.</p>

<h2 id="runtime">Runtime</h2>

<p>While a query is running, you can check if a changeset applies by using its <code class="language-plaintext highlighter-rouge">.active?(context)</code> method. For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Types::Recipe</span>
  <span class="n">field</span> <span class="ss">:flag</span><span class="p">,</span> <span class="no">Types</span><span class="o">::</span><span class="no">RecipeFlag</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">true</span>

  <span class="k">def</span> <span class="nf">flag</span>
    <span class="c1"># Check if this changeset applies to the current request:</span>
    <span class="k">if</span> <span class="no">Changesets</span><span class="o">::</span><span class="no">DeprecateRecipeFlag</span><span class="p">.</span><span class="nf">active?</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="no">Stats</span><span class="p">.</span><span class="nf">count</span><span class="p">(</span><span class="ss">:deprecated_recipe_flag</span><span class="p">,</span> <span class="n">context</span><span class="p">[</span><span class="ss">:viewer</span><span class="p">])</span>
    <span class="k">end</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Besides observability, you can use a runtime check when a resolver needs to pick a different behavior depending on the API version.</p>

<p>After defining a changeset, add it to the schema to <a href="/changesets/releases">release it</a>.</p>

</div>
<p class="guide-footer">
  Suggestion, improvement, or correction?
  <a href="https://github.com/rmosolgo/graphql-ruby/edit/master/guides/changesets/definition.md">Edit this file</a> or
  <a href="https://github.com/rmosolgo/graphql-ruby/issues/new?title=Guide: Defining Changesets">report an issue</a>.
</p>
<script>
  // Find headers with IDs and wrap their text in `<a href=></a>`
  // That way people can easily copy the link.
  var headers = document.querySelectorAll("h1, h2, h3, h4, h5");
  var header, idText, headerLink;
  for (var i = 0; i < headers.length; i++) {
    header = headers[i];
    idText = header.id;
    if (idText) {
      headerLink = document.createElement("a");
      headerLink.href = "#" + idText;
      headerLink.textContent = header.textContent;
      header.textContent = "";
      header.appendChild(headerLink);
    }
  }
  function navigateToSelected(selectElement) {
    var nextPage = selectElement.selectedOptions[0].dataset["target"]
    document.location = nextPage
  }
</script>

    </div>
    <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearchLite.min.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
