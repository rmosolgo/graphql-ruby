<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: GraphQL::Subscriptions
  
    &mdash; GraphQL Ruby API Documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "GraphQL::Subscriptions";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span>
     &raquo; 
    <span class="title">Subscriptions</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: GraphQL::Subscriptions
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">GraphQL::Subscriptions</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/graphql/subscriptions.rb<span class="defines">,<br />
  lib/graphql/subscriptions/event.rb,<br /> lib/graphql/subscriptions/serialize.rb,<br /> lib/graphql/subscriptions/broadcast_analyzer.rb,<br /> lib/graphql/subscriptions/action_cable_subscriptions.rb,<br /> lib/graphql/subscriptions/default_subscription_resolve_extension.rb</span>
</dd>
  </dl>
  
</div>

<div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="Subscriptions/ActionCableSubscriptions.html" title="GraphQL::Subscriptions::ActionCableSubscriptions (class)">ActionCableSubscriptions</a></span></p>
</div>
<h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Subscriptions/Serialize.html" title="GraphQL::Subscriptions::Serialize (module)">Serialize</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Subscriptions/ActionCableSubscriptions.html" title="GraphQL::Subscriptions::ActionCableSubscriptions (class)">ActionCableSubscriptions</a></span>, <span class='object_link'><a href="Subscriptions/BroadcastAnalyzer.html" title="GraphQL::Subscriptions::BroadcastAnalyzer (class)">BroadcastAnalyzer</a></span>, <span class='object_link'><a href="Subscriptions/DefaultSubscriptionResolveExtension.html" title="GraphQL::Subscriptions::DefaultSubscriptionResolveExtension (class)">DefaultSubscriptionResolveExtension</a></span>, <span class='object_link'><a href="Subscriptions/Event.html" title="GraphQL::Subscriptions::Event (class)">Event</a></span>, <span class='object_link'><a href="Subscriptions/InvalidTriggerError.html" title="GraphQL::Subscriptions::InvalidTriggerError (class)">InvalidTriggerError</a></span>, <span class='object_link'><a href="Subscriptions/SubscriptionScopeMissingError.html" title="GraphQL::Subscriptions::SubscriptionScopeMissingError (class)">SubscriptionScopeMissingError</a></span>
    
  
</p>




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_broadcastable-instance_method" title="#default_broadcastable (instance method)">#<strong>default_broadcastable</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Used when fields don’t have <code>broadcastable:</code> explicitly set.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#use-class_method" title="use (class method)">.<strong>use</strong>(defn, options = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#broadcastable%3F-instance_method" title="#broadcastable? (instance method)">#<strong>broadcastable?</strong>(query_str, **query_options)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>If true, then a query like this one would be broadcasted.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_id-instance_method" title="#build_id (instance method)">#<strong>build_id</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new unique identifier for a subscription.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_subscription-instance_method" title="#delete_subscription (instance method)">#<strong>delete_subscription</strong>(subscription_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A subscription was terminated server-side.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deliver-instance_method" title="#deliver (instance method)">#<strong>deliver</strong>(subscription_id, result)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A subscription query was re-evaluated, returning <code>result</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">#<strong>execute</strong>(subscription_id, event, object)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Run the update query for this subscription and deliver it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_all-instance_method" title="#execute_all (instance method)">#<strong>execute_all</strong>(event, object)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Event <code>event</code> occurred on <code>object</code>, Update all subscribers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_update-instance_method" title="#execute_update (instance method)">#<strong>execute_update</strong>(subscription_id, event, object)  &#x21d2; GraphQL::Query::Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p><code>event</code> was triggered on <code>object</code>, and <code>subscription_id</code> was subscribed, so it should be updated.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(schema:, validate_update: true, broadcast: false, default_broadcastable: false, **rest)  &#x21d2; Subscriptions </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of Subscriptions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#normalize_name-instance_method" title="#normalize_name (instance method)">#<strong>normalize_name</strong>(event_or_arg_name)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Convert a user-provided event name or argument to the equivalent in GraphQL.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_subscription-instance_method" title="#read_subscription (instance method)">#<strong>read_subscription</strong>(subscription_id)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The system wants to send an update to this subscription.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#trigger-instance_method" title="#trigger (instance method)">#<strong>trigger</strong>(event_name, args, object, scope: nil, context: {})  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Fetch subscriptions matching this field + arguments pair And pass them off to the queue.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_update%3F-instance_method" title="#validate_update? (instance method)">#<strong>validate_update?</strong>(query:, context:, root_value:, subscription_topic:, operation_name:, variables:)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Define this method to customize whether to validate this subscription when executing an update.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_subscription-instance_method" title="#write_subscription (instance method)">#<strong>write_subscription</strong>(query, events)  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p><code>query</code> was executed and found subscriptions to <code>events</code>.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(schema:, validate_update: true, broadcast: false, default_broadcastable: false, **rest)  &#x21d2; <tt><span class='object_link'><a href="" title="GraphQL::Subscriptions (class)">Subscriptions</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of Subscriptions.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>schema</span>
      
      
        <span class='type'>(<tt>Class</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the GraphQL schema this manager belongs to</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>validate_update</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>If false, then validation is skipped when executing updates</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 40</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>schema:</span><span class='comma'>,</span> <span class='label'>validate_update:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>broadcast:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>default_broadcastable:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_rest'>rest</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_broadcast'>broadcast</span>
    <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_query_analyzer'>query_analyzer</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="" title="GraphQL::Subscriptions (class)">Subscriptions</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Subscriptions/BroadcastAnalyzer.html" title="GraphQL::Subscriptions::BroadcastAnalyzer (class)">BroadcastAnalyzer</a></span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='ivar'>@default_broadcastable</span> <span class='op'>=</span> <span class='id identifier rubyid_default_broadcastable'>default_broadcastable</span>
  <span class='ivar'>@schema</span> <span class='op'>=</span> <span class='id identifier rubyid_schema'>schema</span>
  <span class='ivar'>@validate_update</span> <span class='op'>=</span> <span class='id identifier rubyid_validate_update'>validate_update</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="default_broadcastable-instance_method">
  
    #<strong>default_broadcastable</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns Used when fields don’t have <code>broadcastable:</code> explicitly set.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Used when fields don’t have <code>broadcastable:</code> explicitly set</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_default_broadcastable'>default_broadcastable</span>
  <span class='ivar'>@default_broadcastable</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="use-class_method">
  
    .<strong>use</strong>(defn, options = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>for options, concrete implementations may add options.</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27
28
29
30
31
32
33
34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 25</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='id identifier rubyid_defn'>defn</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_schema'>schema</span> <span class='op'>=</span> <span class='id identifier rubyid_defn'>defn</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Class</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_defn'>defn</span> <span class='op'>:</span> <span class='id identifier rubyid_defn'>defn</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_subscriptions'>subscriptions</span><span class='lparen'>(</span><span class='label'>inherited:</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can&#39;t reinstall subscriptions. </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_schema'>schema</span><span class='embexpr_end'>}</span><span class='tstring_content'> is using </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_subscriptions'>subscriptions</span><span class='embexpr_end'>}</span><span class='tstring_content'>, can&#39;t also add </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:schema</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_schema'>schema</span>
  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_subscriptions'>subscriptions</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_add_subscription_extension_if_necessary'>add_subscription_extension_if_necessary</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="broadcastable?-instance_method">
  
    #<strong>broadcastable?</strong>(query_str, **query_options)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns if true, then a query like this one would be broadcasted.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if true, then a query like this one would be broadcasted</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


233
234
235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 233</span>

<span class='kw'>def</span> <span class='id identifier rubyid_broadcastable?'>broadcastable?</span><span class='lparen'>(</span><span class='id identifier rubyid_query_str'>query_str</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_query_options'>query_options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='ivar'>@schema</span><span class='period'>.</span><span class='id identifier rubyid_query_class'>query_class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@schema</span><span class='comma'>,</span> <span class='id identifier rubyid_query_str'>query_str</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_query_options'>query_options</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_valid?'>valid?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid query: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_validation_errors'>validation_errors</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='const'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Analysis.html" title="GraphQL::Analysis (module)">Analysis</a></span></span><span class='period'>.</span><span class='id identifier rubyid_analyze_query'><span class='object_link'><a href="Analysis.html#analyze_query-class_method" title="GraphQL::Analysis.analyze_query (method)">analyze_query</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='ivar'>@schema</span><span class='period'>.</span><span class='id identifier rubyid_query_analyzers'>query_analyzers</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:subscriptions</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:subscription_broadcastable</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_id-instance_method">
  
    #<strong>build_id</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns A new unique identifier for a subscription.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A new unique identifier for a subscription</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 216</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_id'>build_id</span>
  <span class='const'>SecureRandom</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_subscription-instance_method">
  
    #<strong>delete_subscription</strong>(subscription_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>A subscription was terminated server-side.
Clean up the database.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>subscription_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>void.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">GraphQL::RequiredImplementationMissingError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 211</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_subscription'>delete_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">RequiredImplementationMissingError</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="deliver-instance_method">
  
    #<strong>deliver</strong>(subscription_id, result)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>A subscription query was re-evaluated, returning <code>result</code>.
The result should be send to <code>subscription_id</code>.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>subscription_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>result</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">GraphQL::RequiredImplementationMissingError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deliver'>deliver</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='comma'>,</span> <span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">RequiredImplementationMissingError</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute-instance_method">
  
    #<strong>execute</strong>(subscription_id, event, object)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Run the update query for this subscription and deliver it</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>GraphQL::Subscriptions.{{#execute_update}</li>
    
      <li>GraphQL::Subscriptions.{{#deliver}</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 158</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_execute_update'>execute_update</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_deliver'>deliver</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='comma'>,</span> <span class='id identifier rubyid_res'>res</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:subscriptions</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:unsubscribed</span><span class='rbracket'>]</span>
      <span class='comment'># `unsubscribe` was called, clean up on our side
</span>      <span class='comment'># The transport should also send `{more: false}` to client
</span>      <span class='id identifier rubyid_delete_subscription'>delete_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_all-instance_method">
  
    #<strong>execute_all</strong>(event, object)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Event <code>event</code> occurred on <code>object</code>,
Update all subscribers.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>event</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Subscriptions/Event.html" title="GraphQL::Subscriptions::Event (class)">Subscriptions::Event</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">GraphQL::RequiredImplementationMissingError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 177</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_all'>execute_all</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">RequiredImplementationMissingError</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_update-instance_method">
  
    #<strong>execute_update</strong>(subscription_id, event, object)  &#x21d2; <tt><span class='object_link'><a href="Query/Result.html" title="GraphQL::Query::Result (class)">GraphQL::Query::Result</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p><code>event</code> was triggered on <code>object</code>, and <code>subscription_id</code> was subscribed,
so it should be updated.</p>

<p>Load <code>subscription_id</code>’s GraphQL data, re-evaluate the query and return the result.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>subscription_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>event</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Subscriptions/Event.html" title="GraphQL::Subscriptions::Event (class)">GraphQL::Subscriptions::Event</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The event which was triggered</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The value for the subscription field</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Query/Result.html" title="GraphQL::Query::Result (class)">GraphQL::Query::Result</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_update'>execute_update</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='comma'>,</span> <span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
  <span class='comment'># Lookup the saved data for this subscription
</span>  <span class='id identifier rubyid_query_data'>query_data</span> <span class='op'>=</span> <span class='id identifier rubyid_read_subscription'>read_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_query_data'>query_data</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_delete_subscription'>delete_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># Fetch the required keys from the saved data
</span>  <span class='id identifier rubyid_query_string'>query_string</span> <span class='op'>=</span> <span class='id identifier rubyid_query_data'>query_data</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:query_string</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_variables'>variables</span> <span class='op'>=</span> <span class='id identifier rubyid_query_data'>query_data</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:variables</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_query_data'>query_data</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:context</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_operation_name'>operation_name</span> <span class='op'>=</span> <span class='id identifier rubyid_query_data'>query_data</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:operation_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_execute_options'>execute_options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>query:</span> <span class='id identifier rubyid_query_string'>query_string</span><span class='comma'>,</span>
    <span class='label'>context:</span> <span class='id identifier rubyid_context'>context</span><span class='comma'>,</span>
    <span class='label'>subscription_topic:</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_topic'>topic</span><span class='comma'>,</span>
    <span class='label'>operation_name:</span> <span class='id identifier rubyid_operation_name'>operation_name</span><span class='comma'>,</span>
    <span class='label'>variables:</span> <span class='id identifier rubyid_variables'>variables</span><span class='comma'>,</span>
    <span class='label'>root_value:</span> <span class='id identifier rubyid_object'>object</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>

   <span class='comment'># merge event&#39;s and query&#39;s context together
</span>  <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_execute_options'>execute_options</span><span class='lbracket'>[</span><span class='symbol'>:validate</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_validate_update?'>validate_update?</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_execute_options'>execute_options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='ivar'>@schema</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_execute_options'>execute_options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_subscriptions_context'>subscriptions_context</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:subscriptions</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_subscriptions_context'>subscriptions_context</span><span class='lbracket'>[</span><span class='symbol'>:no_update</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_subscriptions_context'>subscriptions_context</span><span class='lbracket'>[</span><span class='symbol'>:unsubscribed</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_subscriptions_context'>subscriptions_context</span><span class='lbracket'>[</span><span class='symbol'>:final_update</span><span class='rbracket'>]</span>
    <span class='comment'># `unsubscribe` was called, clean up on our side
</span>    <span class='comment'># The transport should also send `{more: false}` to client
</span>    <span class='id identifier rubyid_delete_subscription'>delete_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="normalize_name-instance_method">
  
    #<strong>normalize_name</strong>(event_or_arg_name)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Convert a user-provided event name or argument
to the equivalent in GraphQL.</p>

<p>By default, it converts the identifier to camelcase.
Override this in a subclass to change the transformation.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>event_or_arg_name</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


228
229
230</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 228</span>

<span class='kw'>def</span> <span class='id identifier rubyid_normalize_name'>normalize_name</span><span class='lparen'>(</span><span class='id identifier rubyid_event_or_arg_name'>event_or_arg_name</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="Schema.html" title="GraphQL::Schema (class)">Schema</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Schema/Member.html" title="GraphQL::Schema::Member (class)">Member</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Schema/Member/BuildType.html" title="GraphQL::Schema::Member::BuildType (module)">BuildType</a></span></span><span class='period'>.</span><span class='id identifier rubyid_camelize'><span class='object_link'><a href="Schema/Member/BuildType.html#camelize-class_method" title="GraphQL::Schema::Member::BuildType.camelize (method)">camelize</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_event_or_arg_name'>event_or_arg_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_subscription-instance_method">
  
    #<strong>read_subscription</strong>(subscription_id)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The system wants to send an update to this subscription.
Read its data and return it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>subscription_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Containing required keys</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">GraphQL::RequiredImplementationMissingError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 185</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_subscription'>read_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_subscription_id'>subscription_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">RequiredImplementationMissingError</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="trigger-instance_method">
  
    #<strong>trigger</strong>(event_name, args, object, scope: nil, context: {})  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Fetch subscriptions matching this field + arguments pair
And pass them off to the queue.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>event_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>Hash&lt;String, Symbol =&gt; Object]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>rgs [Hash&lt;String, Symbol =&gt; Object]</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>object</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>scope</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>context</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_trigger'>trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_event_name'>event_name</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='comma'>,</span> <span class='label'>scope:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='comment'># Make something as context-like as possible, even though there isn&#39;t a current query:
</span>  <span class='id identifier rubyid_dummy_query'>dummy_query</span> <span class='op'>=</span> <span class='ivar'>@schema</span><span class='period'>.</span><span class='id identifier rubyid_query_class'>query_class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@schema</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>{ __typename }</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>validate:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='id identifier rubyid_context'>context</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_dummy_query'>dummy_query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span>
  <span class='id identifier rubyid_event_name'>event_name</span> <span class='op'>=</span> <span class='id identifier rubyid_event_name'>event_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

  <span class='comment'># Try with the verbatim input first:
</span>  <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_dummy_query'>dummy_query</span><span class='period'>.</span><span class='id identifier rubyid_types'>types</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='ivar'>@schema</span><span class='period'>.</span><span class='id identifier rubyid_subscription'>subscription</span><span class='comma'>,</span> <span class='id identifier rubyid_event_name'>event_name</span><span class='rparen'>)</span> <span class='comment'># rubocop:disable Development/ContextIsPassedCop
</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='comment'># And if it wasn&#39;t found, normalize it:
</span>    <span class='id identifier rubyid_normalized_event_name'>normalized_event_name</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_name'>normalize_name</span><span class='lparen'>(</span><span class='id identifier rubyid_event_name'>event_name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_field'>field</span> <span class='op'>=</span> <span class='id identifier rubyid_dummy_query'>dummy_query</span><span class='period'>.</span><span class='id identifier rubyid_types'>types</span><span class='period'>.</span><span class='id identifier rubyid_field'>field</span><span class='lparen'>(</span><span class='ivar'>@schema</span><span class='period'>.</span><span class='id identifier rubyid_subscription'>subscription</span><span class='comma'>,</span> <span class='id identifier rubyid_normalized_event_name'>normalized_event_name</span><span class='rparen'>)</span> <span class='comment'># rubocop:disable Development/ContextIsPassedCop
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="Subscriptions/InvalidTriggerError.html" title="GraphQL::Subscriptions::InvalidTriggerError (class)">InvalidTriggerError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No subscription matching trigger: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_event_name'>event_name</span><span class='embexpr_end'>}</span><span class='tstring_content'> (looked for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@schema</span><span class='period'>.</span><span class='id identifier rubyid_subscription'>subscription</span><span class='period'>.</span><span class='id identifier rubyid_graphql_name'>graphql_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_normalized_event_name'>normalized_event_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Since we found a field, the original input was already normalized
</span>    <span class='id identifier rubyid_normalized_event_name'>normalized_event_name</span> <span class='op'>=</span> <span class='id identifier rubyid_event_name'>event_name</span>
  <span class='kw'>end</span>

  <span class='comment'># Normalize symbol-keyed args to strings, try camelizing them
</span>  <span class='comment'># Should this accept a real context somehow?
</span>  <span class='id identifier rubyid_normalized_args'>normalized_args</span> <span class='op'>=</span> <span class='id identifier rubyid_normalize_arguments'>normalize_arguments</span><span class='lparen'>(</span><span class='id identifier rubyid_normalized_event_name'>normalized_event_name</span><span class='comma'>,</span> <span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Query.html" title="GraphQL::Query (class)">Query</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Query/NullContext.html" title="GraphQL::Query::NullContext (class)">NullContext</a></span></span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="GraphQL::Subscriptions (class)">Subscriptions</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Subscriptions/Event.html" title="GraphQL::Subscriptions::Event (class)">Event</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Subscriptions/Event.html#initialize-instance_method" title="GraphQL::Subscriptions::Event#initialize (method)">new</a></span></span><span class='lparen'>(</span>
    <span class='label'>name:</span> <span class='id identifier rubyid_normalized_event_name'>normalized_event_name</span><span class='comma'>,</span>
    <span class='label'>arguments:</span> <span class='id identifier rubyid_normalized_args'>normalized_args</span><span class='comma'>,</span>
    <span class='label'>field:</span> <span class='id identifier rubyid_field'>field</span><span class='comma'>,</span>
    <span class='label'>scope:</span> <span class='id identifier rubyid_scope'>scope</span><span class='comma'>,</span>
    <span class='label'>context:</span> <span class='id identifier rubyid_context'>context</span><span class='comma'>,</span>
  <span class='rparen'>)</span>
  <span class='id identifier rubyid_execute_all'>execute_all</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='comma'>,</span> <span class='id identifier rubyid_object'>object</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate_update?-instance_method">
  
    #<strong>validate_update?</strong>(query:, context:, root_value:, subscription_topic:, operation_name:, variables:)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Define this method to customize whether to validate
this subscription when executing an update.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>defaults to <code>true</code>, or false if <code>validate: false</code> is provided.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate_update?'>validate_update?</span><span class='lparen'>(</span><span class='label'>query:</span><span class='comma'>,</span> <span class='label'>context:</span><span class='comma'>,</span> <span class='label'>root_value:</span><span class='comma'>,</span> <span class='label'>subscription_topic:</span><span class='comma'>,</span> <span class='label'>operation_name:</span><span class='comma'>,</span> <span class='label'>variables:</span><span class='rparen'>)</span>
  <span class='ivar'>@validate_update</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_subscription-instance_method">
  
    #<strong>write_subscription</strong>(query, events)  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p><code>query</code> was executed and found subscriptions to <code>events</code>.
Update the database to reflect this new state.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>query</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Query.html" title="GraphQL::Query (class)">GraphQL::Query</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>events</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Subscriptions/Event.html" title="GraphQL::Subscriptions::Event (class)">GraphQL::Subscriptions::Event</a></span>&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">GraphQL::RequiredImplementationMissingError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/subscriptions.rb', line 203</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_subscription'>write_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_events'>events</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RequiredImplementationMissingError.html" title="GraphQL::RequiredImplementationMissingError (class)">RequiredImplementationMissingError</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Jul 15 18:31:15 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.2.4).
</div>

    </div>
  </body>
</html>