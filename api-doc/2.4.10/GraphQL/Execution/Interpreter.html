<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: GraphQL::Execution::Interpreter
  
    &mdash; GraphQL Ruby API Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "GraphQL::Execution::Interpreter";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Execution.html" title="GraphQL::Execution (module)">Execution</a></span></span>
     &raquo; 
    <span class="title">Interpreter</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: GraphQL::Execution::Interpreter
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">GraphQL::Execution::Interpreter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/graphql/execution/interpreter.rb<span class="defines">,<br />
  lib/graphql/execution/interpreter/resolve.rb,<br /> lib/graphql/execution/interpreter/runtime.rb,<br /> lib/graphql/execution/interpreter/arguments.rb,<br /> lib/graphql/execution/interpreter/argument_value.rb,<br /> lib/graphql/execution/interpreter/arguments_cache.rb,<br /> lib/graphql/execution/interpreter/execution_errors.rb,<br /> lib/graphql/execution/interpreter/handles_raw_value.rb,<br /> lib/graphql/execution/interpreter/runtime/graphql_result.rb</span>
</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Interpreter/Resolve.html" title="GraphQL::Execution::Interpreter::Resolve (module)">Resolve</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Interpreter/ArgumentValue.html" title="GraphQL::Execution::Interpreter::ArgumentValue (class)">ArgumentValue</a></span>, <span class='object_link'><a href="Interpreter/Arguments.html" title="GraphQL::Execution::Interpreter::Arguments (class)">Arguments</a></span>, <span class='object_link'><a href="Interpreter/ArgumentsCache.html" title="GraphQL::Execution::Interpreter::ArgumentsCache (class)">ArgumentsCache</a></span>, <span class='object_link'><a href="Interpreter/ExecutionErrors.html" title="GraphQL::Execution::Interpreter::ExecutionErrors (class)">ExecutionErrors</a></span>, <span class='object_link'><a href="Interpreter/ListResultFailedError.html" title="GraphQL::Execution::Interpreter::ListResultFailedError (class)">ListResultFailedError</a></span>, <span class='object_link'><a href="Interpreter/RawValue.html" title="GraphQL::Execution::Interpreter::RawValue (class)">RawValue</a></span>, <span class='object_link'><a href="Interpreter/Runtime.html" title="GraphQL::Execution::Interpreter::Runtime (class)">Runtime</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="NO_OPERATION-constant" class="">NO_OPERATION =
          <div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This constant is part of a private API.</strong>
  You should avoid using this constant if possible, as it may be removed or be changed in the future.
</p>
<p>Used internally to signal that the query shouldnâ€™t be executed</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../EmptyObjects.html" title="GraphQL::EmptyObjects (module)">EmptyObjects</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../EmptyObjects.html#EMPTY_HASH-constant" title="GraphQL::EmptyObjects::EMPTY_HASH (constant)">EMPTY_HASH</a></span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run_all-class_method" title="run_all (class method)">.<strong>run_all</strong>(schema, query_options, context: {}, max_complexity: schema.max_complexity)  &#x21d2; Array&lt;GraphQL::Query::Result&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>One result per query.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="run_all-class_method">
  
    .<strong>run_all</strong>(schema, query_options, context: {}, max_complexity: schema.max_complexity)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="../Query/Result.html" title="GraphQL::Query::Result (class)">GraphQL::Query::Result</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns One result per query.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>schema</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Schema.html" title="GraphQL::Schema (class)">GraphQL::Schema</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>queries</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Query.html" title="GraphQL::Query (class)">GraphQL::Query</a></span>, Hash&gt;</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>context</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>max_complexity</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>schema.max_complexity</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Query/Result.html" title="GraphQL::Query::Result (class)">GraphQL::Query::Result</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>One result per query</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/execution/interpreter.rb', line 24</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run_all'>run_all</span><span class='lparen'>(</span><span class='id identifier rubyid_schema'>schema</span><span class='comma'>,</span> <span class='id identifier rubyid_query_options'>query_options</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>max_complexity:</span> <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_max_complexity'>max_complexity</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_queries'>queries</span> <span class='op'>=</span> <span class='id identifier rubyid_query_options'>query_options</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_opts'>opts</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_opts'>opts</span>
    <span class='kw'>when</span> <span class='const'>Hash</span>
      <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_query_class'>query_class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_schema'>schema</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Query.html" title="GraphQL::Query (class)">Query</a></span></span>
      <span class='id identifier rubyid_opts'>opts</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Expected Hash or GraphQL::Query, not </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>


  <span class='id identifier rubyid_multiplex'>multiplex</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Execution.html" title="GraphQL::Execution (module)">Execution</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Multiplex.html" title="GraphQL::Execution::Multiplex (class)">Multiplex</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Multiplex.html#initialize-instance_method" title="GraphQL::Execution::Multiplex#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>schema:</span> <span class='id identifier rubyid_schema'>schema</span><span class='comma'>,</span> <span class='label'>queries:</span> <span class='id identifier rubyid_queries'>queries</span><span class='comma'>,</span> <span class='label'>context:</span> <span class='id identifier rubyid_context'>context</span><span class='comma'>,</span> <span class='label'>max_complexity:</span> <span class='id identifier rubyid_max_complexity'>max_complexity</span><span class='rparen'>)</span>
  <span class='const'>Fiber</span><span class='lbracket'>[</span><span class='symbol'>:__graphql_current_multiplex</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_multiplex'>multiplex</span>
  <span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_current_trace'>current_trace</span>
  <span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_begin_execute_multiplex'>begin_execute_multiplex</span><span class='lparen'>(</span><span class='id identifier rubyid_multiplex'>multiplex</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_execute_multiplex'>execute_multiplex</span><span class='lparen'>(</span><span class='label'>multiplex:</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_schema'>schema</span> <span class='op'>=</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_schema'>schema</span>
    <span class='id identifier rubyid_queries'>queries</span> <span class='op'>=</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_queries'>queries</span>
    <span class='id identifier rubyid_lazies_at_depth'>lazies_at_depth</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_multiplex_analyzers'>multiplex_analyzers</span> <span class='op'>=</span> <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_multiplex_analyzers'>multiplex_analyzers</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_max_complexity'>max_complexity</span>
      <span class='id identifier rubyid_multiplex_analyzers'>multiplex_analyzers</span> <span class='op'>+=</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Analysis.html" title="GraphQL::Analysis (module)">Analysis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Analysis/MaxQueryComplexity.html" title="GraphQL::Analysis::MaxQueryComplexity (class)">MaxQueryComplexity</a></span></span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_begin_analyze_multiplex'>begin_analyze_multiplex</span><span class='lparen'>(</span><span class='id identifier rubyid_multiplex'>multiplex</span><span class='comma'>,</span> <span class='id identifier rubyid_multiplex_analyzers'>multiplex_analyzers</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_analysis_engine'>analysis_engine</span><span class='period'>.</span><span class='id identifier rubyid_analyze_multiplex'>analyze_multiplex</span><span class='lparen'>(</span><span class='id identifier rubyid_multiplex'>multiplex</span><span class='comma'>,</span> <span class='id identifier rubyid_multiplex_analyzers'>multiplex_analyzers</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_end_analyze_multiplex'>end_analyze_multiplex</span><span class='lparen'>(</span><span class='id identifier rubyid_multiplex'>multiplex</span><span class='comma'>,</span> <span class='id identifier rubyid_multiplex_analyzers'>multiplex_analyzers</span><span class='rparen'>)</span>

    <span class='kw'>begin</span>
      <span class='comment'># Since this is basically the batching context,
</span>      <span class='comment'># share it for a whole multiplex
</span>      <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='lbracket'>[</span><span class='symbol'>:interpreter_instance</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_query_execution_strategy'>query_execution_strategy</span><span class='lparen'>(</span><span class='label'>deprecation_warning:</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='comment'># Do as much eager evaluation of the query as possible
</span>      <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_queries'>queries</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_subscription?'>subscription?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_subscription_update?'>subscription_update?</span>
          <span class='id identifier rubyid_subs_namespace'>subs_namespace</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:subscriptions</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_subs_namespace'>subs_namespace</span><span class='lbracket'>[</span><span class='symbol'>:events</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_subs_namespace'>subs_namespace</span><span class='lbracket'>[</span><span class='symbol'>:subscriptions</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_dataloader'>dataloader</span><span class='period'>.</span><span class='id identifier rubyid_append_job'>append_job</span> <span class='lbrace'>{</span>
          <span class='id identifier rubyid_operation'>operation</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_selected_operation'>selected_operation</span>
          <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_operation'>operation</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_valid?'>valid?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='const'><span class='object_link'><a href="#NO_OPERATION-constant" title="GraphQL::Execution::Interpreter::NO_OPERATION (constant)">NO_OPERATION</a></span></span>
          <span class='kw'>else</span>
            <span class='kw'>begin</span>
              <span class='comment'># Although queries in a multiplex _share_ an Interpreter instance,
</span>              <span class='comment'># they also have another item of state, which is private to that query
</span>              <span class='comment'># in particular, assign it here:
</span>              <span class='id identifier rubyid_runtime'>runtime</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Interpreter/Runtime.html" title="GraphQL::Execution::Interpreter::Runtime (class)">Runtime</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Interpreter/Runtime.html#initialize-instance_method" title="GraphQL::Execution::Interpreter::Runtime#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>query:</span> <span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='label'>lazies_at_depth:</span> <span class='id identifier rubyid_lazies_at_depth'>lazies_at_depth</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:interpreter_runtime</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:runtime</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime'>runtime</span>

              <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_current_trace'>current_trace</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span><span class='lparen'>(</span><span class='label'>query:</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_run_eager'>run_eager</span>
              <span class='kw'>end</span>
            <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ExecutionError.html" title="GraphQL::ExecutionError (class)">ExecutionError</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_err'>err</span>
              <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_err'>err</span>
              <span class='const'><span class='object_link'><a href="#NO_OPERATION-constant" title="GraphQL::Execution::Interpreter::NO_OPERATION (constant)">NO_OPERATION</a></span></span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
          <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span>
        <span class='rbrace'>}</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_dataloader'>dataloader</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>

      <span class='comment'># Then, work through lazy results in a breadth-first way
</span>      <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_dataloader'>dataloader</span><span class='period'>.</span><span class='id identifier rubyid_append_job'>append_job</span> <span class='lbrace'>{</span>
        <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_queries'>queries</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_queries'>queries</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_queries'>queries</span> <span class='op'>=</span> <span class='id identifier rubyid_multiplex'>multiplex</span> <span class='op'>?</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_queries'>queries</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='id identifier rubyid_query'>query</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_final_values'>final_values</span> <span class='op'>=</span> <span class='id identifier rubyid_queries'>queries</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
          <span class='id identifier rubyid_runtime'>runtime</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:interpreter_runtime</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:runtime</span><span class='rbracket'>]</span>
          <span class='comment'># it might not be present if the query has an error
</span>          <span class='id identifier rubyid_runtime'>runtime</span> <span class='op'>?</span> <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_final_result'>final_result</span> <span class='op'>:</span> <span class='kw'>nil</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_final_values'>final_values</span><span class='period'>.</span><span class='id identifier rubyid_compact!'>compact!</span>
        <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_current_trace'>current_trace</span><span class='period'>.</span><span class='id identifier rubyid_execute_query_lazy'>execute_query_lazy</span><span class='lparen'>(</span><span class='label'>multiplex:</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='comma'>,</span> <span class='label'>query:</span> <span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span> <span class='kw'>do</span>
          <span class='const'><span class='object_link'><a href="" title="GraphQL::Execution::Interpreter (class)">Interpreter</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Interpreter/Resolve.html" title="GraphQL::Execution::Interpreter::Resolve (module)">Resolve</a></span></span><span class='period'>.</span><span class='id identifier rubyid_resolve_each_depth'><span class='object_link'><a href="Interpreter/Resolve.html#resolve_each_depth-class_method" title="GraphQL::Execution::Interpreter::Resolve.resolve_each_depth (method)">resolve_each_depth</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_lazies_at_depth'>lazies_at_depth</span><span class='comma'>,</span> <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_dataloader'>dataloader</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='rbrace'>}</span>
      <span class='id identifier rubyid_multiplex'>multiplex</span><span class='period'>.</span><span class='id identifier rubyid_dataloader'>dataloader</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span>

      <span class='comment'># Then, find all errors and assign the result to the query object
</span>      <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data_result'>data_result</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
        <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_queries'>queries</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_events'>events</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:subscriptions</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:events</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
          <span class='id identifier rubyid_schema'>schema</span><span class='period'>.</span><span class='id identifier rubyid_subscriptions'>subscriptions</span><span class='period'>.</span><span class='id identifier rubyid_write_subscription'>write_subscription</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_events'>events</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='comment'># Assign the result so that it can be accessed in instrumentation
</span>        <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_result_values'>result_values</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_data_result'>data_result</span><span class='period'>.</span><span class='id identifier rubyid_equal?'>equal?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#NO_OPERATION-constant" title="GraphQL::Execution::Interpreter::NO_OPERATION (constant)">NO_OPERATION</a></span></span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_valid?'>valid?</span> <span class='op'>||</span> <span class='op'>!</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='comment'># A bit weird, but `Query#static_errors` _includes_ `query.context.errors`
</span>            <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>errors</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_static_errors'>static_errors</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_data_result'>data_result</span>
          <span class='kw'>end</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

          <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_error_result'>error_result</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>errors</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_error_result'>error_result</span>
          <span class='kw'>end</span>

          <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:interpreter_runtime</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:runtime</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_final_result'>final_result</span>

          <span class='id identifier rubyid_result'>result</span>
        <span class='kw'>end</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace?'>namespace?</span><span class='lparen'>(</span><span class='symbol'>:__query_result_extensions__</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_result_values'>result_values</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extensions</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:__query_result_extensions__</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='comment'># Get the Query::Result, not the Hash
</span>        <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_results'>results</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span>
      <span class='comment'># TODO rescue at a higher level so it will catch errors in analysis, too
</span>      <span class='comment'># Assign values here so that the query&#39;s `@executed` becomes true
</span>      <span class='id identifier rubyid_queries'>queries</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_q'>q</span><span class='op'>|</span> <span class='id identifier rubyid_q'>q</span><span class='period'>.</span><span class='id identifier rubyid_result_values'>result_values</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_raise'>raise</span>
    <span class='kw'>ensure</span>
      <span class='const'>Fiber</span><span class='lbracket'>[</span><span class='symbol'>:__graphql_current_multiplex</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_queries'>queries</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_query'>query</span><span class='op'>|</span>
        <span class='id identifier rubyid_runtime'>runtime</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_namespace'>namespace</span><span class='lparen'>(</span><span class='symbol'>:interpreter_runtime</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:runtime</span><span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_runtime'>runtime</span>
          <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_delete_all_interpreter_context'>delete_all_interpreter_context</span>
        <span class='kw'>end</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='id identifier rubyid_trace'>trace</span><span class='op'>&amp;.</span><span class='id identifier rubyid_end_execute_multiplex'>end_execute_multiplex</span><span class='lparen'>(</span><span class='id identifier rubyid_multiplex'>multiplex</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Feb 18 20:42:48 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.2.7).
</div>

    </div>
  </body>
</html>